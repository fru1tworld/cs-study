# RFC 1035: Domain Names - Implementation and Specification

> DNS 패킷의 구조와 실제 구현 명세 (RFC 1034와 세트)

## 1. 개요

RFC 1035는 도메인 네임 시스템(DNS)의 구현과 명세를 다루는 핵심 기술 문서입니다. DNS는 서로 다른 호스트, 네트워크, 프로토콜 패밀리, 인터넷 및 행정 조직에서 자원을 명명할 수 있는 메커니즘을 제공합니다.

### 핵심 목적
- 분산된 도메인 네임 시스템의 프로토콜 명세
- DNS 메시지 형식 정의
- 리소스 레코드(RR) 구조 및 타입 정의
- 네임서버와 리졸버의 구현 가이드라인 제공

---

## 2. DNS 메시지 형식

DNS 메시지는 5개 섹션으로 구성됩니다:

```
+---------------------+
|        Header       |  <- 고정 12바이트
+---------------------+
|       Question      |  <- 질의 섹션
+---------------------+
|        Answer       |  <- 응답 RR들
+---------------------+
|      Authority      |  <- 권한 RR들
+---------------------+
|      Additional     |  <- 추가 RR들
+---------------------+
```

### 2.1 헤더 섹션 (Header) - 12바이트

```
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      ID                       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    QDCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ANCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    NSCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ARCOUNT                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

| 필드 | 크기 | 설명 |
|------|------|------|
| ID | 16비트 | 쿼리와 응답을 매칭하는 식별자 |
| QR | 1비트 | 0=쿼리, 1=응답 |
| Opcode | 4비트 | 쿼리 유형 (0=QUERY, 1=IQUERY, 2=STATUS) |
| AA | 1비트 | Authoritative Answer - 권한 있는 응답 표시 |
| TC | 1비트 | Truncation - 메시지 절단 여부 |
| RD | 1비트 | Recursion Desired - 재귀 쿼리 요청 |
| RA | 1비트 | Recursion Available - 재귀 쿼리 지원 여부 |
| Z | 3비트 | 예약됨 (항상 0) |
| RCODE | 4비트 | 응답 코드 |
| QDCOUNT | 16비트 | Question 섹션의 엔트리 수 |
| ANCOUNT | 16비트 | Answer 섹션의 RR 수 |
| NSCOUNT | 16비트 | Authority 섹션의 RR 수 |
| ARCOUNT | 16비트 | Additional 섹션의 RR 수 |

#### 헤더 필드 상세 설명

ID (Identification)
- 16비트 식별자로, 프로그램에 의해 할당됨
- 쿼리를 생성할 때 설정되며, 응답 메시지에 복사됨
- 여러 미해결 쿼리를 구분하기 위해 사용
- 각 쿼리에 고유한 ID를 부여하여 요청-응답 매칭에 활용

QR (Query/Response)
- 쿼리(0) 또는 응답(1)을 구분하는 1비트 필드
- 메시지가 질의인지 응답인지 즉시 판별 가능

Opcode (Operation Code)
- 4비트 필드로 쿼리의 종류를 지정
- 값 0: QUERY - 표준 쿼리
- 값 1: IQUERY - 역방향 쿼리 (deprecated)
- 값 2: STATUS - 서버 상태 요청
- 값 3-15: 미래 사용을 위해 예약됨

AA (Authoritative Answer)
- 응답하는 네임서버가 해당 도메인에 대해 권한이 있는지 표시
- 응답 메시지에서만 유효
- 1이면 해당 존의 권한 있는 네임서버가 직접 응답한 것

TC (Truncation)
- 메시지가 허용된 크기를 초과하여 절단되었는지 표시
- UDP의 경우 512바이트 초과 시 설정
- 설정된 경우 클라이언트는 TCP로 재시도해야 함

RD (Recursion Desired)
- 클라이언트가 재귀 쿼리를 원하는지 표시
- 1로 설정하면 네임서버에게 재귀적 해결을 요청
- 쿼리에서 설정되며 응답에 복사됨

RA (Recursion Available)
- 네임서버가 재귀 쿼리를 지원하는지 표시
- 응답에서 네임서버가 설정
- 재귀 서비스 가용성을 클라이언트에게 알림

Z (Reserved)
- 3비트 예약 필드
- 모든 쿼리와 응답에서 0으로 설정
- 향후 확장을 위해 예약됨

RCODE (Response Code)
- 4비트 필드로 응답 상태를 표시
- 응답 메시지에서만 의미 있음
- 쿼리 처리 결과를 나타냄

QDCOUNT, ANCOUNT, NSCOUNT, ARCOUNT
- 각각 Question, Answer, Authority, Additional 섹션의 엔트리 수를 나타내는 16비트 부호 없는 정수
- 섹션이 비어있으면 0

#### RCODE (응답 코드) 완전 목록

| 값 | 이름 | 설명 |
|----|------|------|
| 0 | NOERROR | 오류 없음. 쿼리가 성공적으로 완료됨 |
| 1 | FORMERR | 형식 오류. 네임서버가 쿼리를 해석할 수 없음 |
| 2 | SERVFAIL | 서버 실패. 네임서버 내부 문제로 쿼리 처리 불가 |
| 3 | NXDOMAIN | 이름 오류. 권한 있는 네임서버에서만 의미 있으며, 참조된 도메인 명이 존재하지 않음 |
| 4 | NOTIMP | 미구현. 네임서버가 해당 종류의 쿼리를 지원하지 않음 |
| 5 | REFUSED | 거부됨. 네임서버가 정책상의 이유로 작업 수행을 거부 |
| 6-15 | (예약됨) | 미래 사용을 위해 예약됨 |

### 2.2 Question 섹션

각 질문의 형식:

```
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                                               |
/                     QNAME                     /
/                                               /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                     QTYPE                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                     QCLASS                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

| 필드 | 설명 |
|------|------|
| QNAME | 조회할 도메인 명 (라벨 시퀀스, null로 종료) |
| QTYPE | 조회 타입 (TYPE 값의 상위집합) |
| QCLASS | 조회 클래스 (CLASS 값의 상위집합) |

#### QTYPE 값

QTYPE은 RR TYPE 값의 상위집합으로, 모든 TYPE 값과 함께 다음의 추가 값을 포함합니다:

| 값 | 니모닉 | 설명 |
|----|--------|------|
| 252 | AXFR | 존 전송 요청 (전체 존 데이터) |
| 253 | MAILB | 메일박스 관련 레코드 요청 (MB, MG, MR) |
| 254 | MAILA | 메일 에이전트 RR 요청 (deprecated, MX 사용 권장) |
| 255 | * | 모든 레코드 요청 (와일드카드) |

참고: QTYPE 1-16 값은 아래 RR 타입 섹션의 TYPE 값과 동일합니다.

#### QCLASS 값

| 값 | 니모닉 | 설명 |
|----|--------|------|
| 1 | IN | 인터넷 클래스 |
| 2 | CS | CSNET 클래스 (deprecated) |
| 3 | CH | CHAOS 클래스 |
| 4 | HS | Hesiod 클래스 |
| 255 | * | 모든 클래스 (와일드카드) |

#### QNAME 인코딩 예시

`www.example.com`은 다음과 같이 인코딩:
```
3www7example3com0
└─┬─┘└───┬───┘└┬┘└─┐
  │      │     │   │
 "www" "example" "com" null
```

### 2.3 Answer/Authority/Additional 섹션

리소스 레코드(RR)들의 시퀀스로 구성됩니다.

---

## 3. 리소스 레코드 (Resource Record) 형식

```
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                                               |
/                      NAME                     /
/                                               /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      TYPE                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                     CLASS                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      TTL                      |
|                                               |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                   RDLENGTH                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                     RDATA                     /
/                                               /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

| 필드 | 크기 | 설명 |
|------|------|------|
| NAME | 가변 | 소유자 도메인 명 |
| TYPE | 2옥텟 | 레코드 타입 코드 |
| CLASS | 2옥텟 | 클래스 코드 (IN=1, 인터넷) |
| TTL | 4옥텟 | Time To Live (초 단위, 캐시 유효 시간) |
| RDLENGTH | 2옥텟 | RDATA 길이 |
| RDATA | 가변 | 리소스 데이터 (타입에 따라 형식 결정) |

### 3.1 RR 타입 완전 목록

RFC 1035에서 정의된 모든 TYPE 값입니다:

| 타입 | 값 | 용도 | RDATA 형식 |
|------|-----|------|------------|
| A | 1 | 호스트 IPv4 주소 | 32비트 IP 주소 |
| NS | 2 | 권한 있는 네임서버 | 도메인 명 |
| MD | 3 | 메일 목적지 (deprecated, MX 사용) | 도메인 명 |
| MF | 4 | 메일 전달자 (deprecated, MX 사용) | 도메인 명 |
| CNAME | 5 | 별칭의 정규 명 | 도메인 명 |
| SOA | 6 | 존 권한 개시 | 복합 데이터 (아래 참조) |
| MB | 7 | 메일박스 도메인 명 (실험적) | 도메인 명 |
| MG | 8 | 메일 그룹 멤버 (실험적) | 도메인 명 |
| MR | 9 | 메일 리네임 도메인 명 (실험적) | 도메인 명 |
| NULL | 10 | 널 RR (실험적) | 최대 65535 옥텟의 임의 데이터 |
| WKS | 11 | Well Known Services | 주소 + 프로토콜 + 비트맵 |
| PTR | 12 | 도메인 명 포인터 (역방향 조회) | 도메인 명 |
| HINFO | 13 | 호스트 정보 | CPU, OS 문자열 |
| MINFO | 14 | 메일박스/메일 리스트 정보 | RMAILBX + EMAILBX 도메인 명 |
| MX | 15 | 메일 교환 서버 | 선호도(16비트) + 도메인 명 |
| TXT | 16 | 텍스트 문자열 | 문자열 시퀀스 |

### 3.2 추가 RR 타입 상세

#### MD (Mail Destination) - TYPE 3

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   MADNAME                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- MADNAME: 해당 도메인에 대한 메일을 가진 호스트의 도메인 명
- 더 이상 사용되지 않음: MX 레코드로 대체됨
- MD 레코드를 발견하면 MX RR로 변환하여 처리 권장 (preference=0)

#### MF (Mail Forwarder) - TYPE 4

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   MADNAME                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- MADNAME: 해당 도메인에 대한 메일을 전달하는 호스트의 도메인 명
- 더 이상 사용되지 않음: MX 레코드로 대체됨
- MF 레코드를 발견하면 MX RR로 변환하여 처리 권장 (preference=10)

#### MB (Mailbox) - TYPE 7

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   MADNAME                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- MADNAME: 지정된 메일박스를 가진 호스트의 도메인 명
- 실험적: 메일박스 명을 호스트 위치로 매핑
- MAILB QTYPE 쿼리로 조회 가능

#### MG (Mail Group) - TYPE 8

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   MGMNAME                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- MGMNAME: 메일 그룹의 멤버인 메일박스의 도메인 명
- 실험적: 메일 그룹의 멤버를 지정
- 그룹 메일박스에 대해 여러 MG 레코드 존재 가능

#### MR (Mail Rename) - TYPE 9

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   NEWNAME                     /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- NEWNAME: 메일박스의 적절한(새로운) 이름을 지정하는 도메인 명
- 실험적: 메일박스 명 변경을 나타냄
- 이전 메일박스 명에 대한 포워딩 용도

#### NULL - TYPE 10

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                  <anything>                   /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- <anything>: 최대 65535 옥텟의 임의 데이터
- 실험적: 특정 형식이 정의되지 않음
- 마스터 파일에는 표현할 수 없음
- 실험 목적으로만 사용

#### WKS (Well Known Services) - TYPE 11

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ADDRESS                    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|       PROTOCOL        |                       |
+--+--+--+--+--+--+--+--+                       |
|                                               |
/                   <BIT MAP>                   /
/                                               /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- ADDRESS: 32비트 인터넷 주소
- PROTOCOL: 8비트 IP 프로토콜 번호 (6=TCP, 17=UDP)
- BIT MAP: 가변 길이 비트맵. N번째 비트가 설정되면 해당 호스트가 프로토콜에서 포트 N의 서비스를 지원함
- 예: TCP 포트 25(SMTP)를 지원하면 비트 25가 설정됨

#### HINFO (Host Information) - TYPE 13

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                      CPU                      /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                       OS                      /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- CPU: 호스트의 CPU 유형을 지정하는 문자열 (예: "VAX-11/780", "IBM-PC")
- OS: 호스트의 운영 체제를 지정하는 문자열 (예: "UNIX", "DOS")
- 두 필드 모두 <character-string> 형식
- 표준 CPU/OS 명칭은 별도 RFC에서 정의됨

#### MINFO (Mailbox Information) - TYPE 14

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                    RMAILBX                    /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                    EMAILBX                    /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- RMAILBX: 메일링 리스트 또는 메일박스를 담당하는 메일박스의 도메인 명
- EMAILBX: 메일링 리스트 또는 메일박스의 오류 메시지를 수신할 메일박스의 도메인 명
- 실험적: 메일 리스트 관리 정보 제공

### 3.3 SOA 레코드 형식

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                     MNAME                     /  <- 주 네임서버
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                     RNAME                     /  <- 관리자 메일박스
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    SERIAL                     |  <- 존 버전 번호
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    REFRESH                    |  <- 새로고침 간격
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                     RETRY                     |  <- 재시도 간격
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    EXPIRE                     |  <- 만료 시간
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    MINIMUM                    |  <- 최소 TTL
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

### 3.4 MX 레코드 형식

```
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                  PREFERENCE                   |  <- 선호도 (낮을수록 우선)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   EXCHANGE                    /  <- 메일 서버 도메인 명
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

---

## 4. DNS 쿼리/응답 프로세스

### 4.1 기본 동작 흐름

```
┌─────────────┐                           ┌─────────────┐
│   Client    │                           │ Name Server │
│  (Resolver) │                           │             │
└──────┬──────┘                           └──────┬──────┘
       │                                         │
       │  1. QNAME, QTYPE, QCLASS 변환           │
       │──────────────────────────────────────►  │
       │     UDP 또는 TCP (포트 53)               │
       │                                         │
       │  2. 로컬 존/캐시 검색                    │
       │                                         │
       │  3. 없으면 다른 네임서버로 재귀 조회     │
       │                                         │
       │  ◄──────────────────────────────────────│
       │  4. 응답 (Answer, Authority, Additional) │
       │                                         │
```

### 4.2 재귀 쿼리 vs 반복 쿼리

재귀 쿼리 (Recursive Query)
- 클라이언트가 RD 비트를 1로 설정
- 네임서버가 최종 답을 얻을 때까지 다른 서버에 쿼리
- 클라이언트에게는 최종 결과만 반환

반복 쿼리 (Iterative Query)
- 네임서버가 알고 있는 최선의 정보를 반환
- 더 가까운 네임서버에 대한 참조(referral)를 제공
- 클라이언트가 직접 다음 서버에 쿼리

### 4.3 전송 프로토콜

#### UDP 사용 (기본)
- 포트 53
- 512바이트 이상 메시지는 절단되며 TC 비트 설정
- 저 오버헤드, 빠른 성능
- 재전송 전략 필요 (타임아웃 후 재시도)

#### TCP 사용
- 포트 53
- 신뢰성 있는 전송
- 존 전송(Zone Transfer)에 필수
- 2바이트 길이 필드로 메시지 길이 전송
- 절단된 응답 시 TCP로 재시도

### 4.4 메시지 압축

도메인 명 반복을 줄이기 위해 포인터 메커니즘 사용합니다. DNS 메시지에서 도메인 명은 라벨의 시퀀스로 표현되며, 각 라벨의 첫 2비트가 라벨 타입을 결정합니다.

#### 라벨 타입

```
첫 2비트에 따른 라벨 타입 구분:
+--+--+--+--+--+--+--+--+
| 0  0|   (라벨 길이)   |  <- 일반 라벨 (0-63)
+--+--+--+--+--+--+--+--+
| 1  1|   (포인터)      |  <- 압축 포인터
+--+--+--+--+--+--+--+--+
| 0  1|   (예약됨)      |  <- 미래 사용을 위해 예약
+--+--+--+--+--+--+--+--+
| 1  0|   (예약됨)      |  <- 미래 사용을 위해 예약
+--+--+--+--+--+--+--+--+
```

#### 라벨 타입 상세

| 첫 2비트 | 타입 | 설명 |
|----------|------|------|
| 00 | 일반 라벨 | 나머지 6비트는 라벨 길이 (0-63). 길이 0은 루트를 의미 |
| 01 | 예약됨 | 미래 사용을 위해 예약됨 |
| 10 | 예약됨 | 미래 사용을 위해 예약됨 |
| 11 | 포인터 | 메시지 압축용. 다음 바이트와 함께 14비트 오프셋 형성 |

#### 압축 포인터 형식

```
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
| 1  1|                OFFSET                   |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

- OFFSET: 메시지 시작(ID 필드 시작)부터의 바이트 오프셋 (14비트, 0-16383)
- 포인터가 가리키는 위치부터 도메인 명의 나머지가 시작됨
- 포인터는 항상 2옥텟이며, 다른 라벨은 가변 길이

#### 압축 예시

```
메시지에서 "F.ISI.ARPA", "FOO.F.ISI.ARPA", "ARPA"가 있을 때:

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    20 |           1           |           F           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    22 |           3           |           I           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    24 |           S           |           I           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    26 |           4           |           A           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    28 |           R           |           P           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    30 |           A           |           0           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    40 |           3           |           F           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    42 |           O           |           O           |
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    44 | 1  1|                20                       |  <- 오프셋 20을 가리키는 포인터
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+

       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
    64 | 1  1|                26                       |  <- 오프셋 26을 가리키는 포인터 (ARPA)
       +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
```

위 예시에서:
- 오프셋 20: "F.ISI.ARPA" (전체 라벨)
- 오프셋 40: "FOO.F.ISI.ARPA" (FOO + 오프셋 20으로의 포인터)
- 오프셋 64: "ARPA" (오프셋 26으로의 포인터)

압축 규칙:
- 포인터는 메시지의 이전 위치만 참조해야 함 (순방향 참조)
- 순환 참조 금지 (포인터가 자기 자신이나 이후 위치를 참조하면 안 됨)
- 포인터는 다른 포인터를 가리킬 수 있음 (체인 가능)
- RDATA 내의 도메인 명도 압축 가능 (NS, MX, CNAME 등)
- 포인터는 라벨 시퀀스의 마지막에만 나타나야 함
- 일반 라벨 뒤에 포인터가 올 수 있지만, 포인터 뒤에 다른 라벨이 올 수 없음

---

## 5. 역방향 조회 (Reverse Lookup)

### 5.1 IN-ADDR.ARPA 도메인

IP 주소에서 도메인 명을 찾기 위한 특수 구조:

```
IP 주소: 192.0.2.1
역방향 도메인: 1.2.0.192.in-addr.arpa

쿼리: 1.2.0.192.in-addr.arpa의 PTR 레코드
응답: www.example.com
```

구조적 특징:
- 옥텟 순서가 역전됨 (가장 구체적인 것이 먼저)
- 서브넷 단위로 위임 가능
- PTR 레코드로 호스트 명 저장

---

## 6. 구현 고려사항

### 6.1 네임서버 아키텍처

데이터베이스 구조:
- 카탈로그: 지원 존 목록
- 존 데이터: 권한 있는 레코드
- 캐시: 조회 결과 캐싱

동시성 처리:
- 다중 concurrent 활동 필수
- UDP, TCP, 존 새로고침 병렬 처리
- TCP가 UDP 서비스를 차단하지 않도록

존 새로고침:
- 이전과 새 데이터를 동시에 사용하지 않도록 포인터 교체로 처리
- SOA의 SERIAL로 버전 관리

### 6.2 리졸버 구현

상태 관리:
- 요청별 타임스탬프 (RR 유효성 판단)
- 작업량 제한 카운터 (순환 참조, 네트워크 분할 방지)
- SLIST 구조로 외부 네임서버 상태 추적

쿼리 전략:
- 첫 시도 실패 시 다른 네임서버 우선 시도
- 재전송 간격: 네트워크 성능 기반 (최소 2-5초 권장)
- 응답 순서 독립적 처리

### 6.3 마스터 파일 형식

```
; example.com 존 파일

$ORIGIN example.com.
$TTL 86400

@       IN  SOA   ns1.example.com. admin.example.com. (
                  2023010101  ; Serial
                  3600        ; Refresh (1 hour)
                  600         ; Retry (10 minutes)
                  604800      ; Expire (1 week)
                  86400 )     ; Minimum TTL (1 day)

        IN  NS    ns1.example.com.
        IN  NS    ns2.example.com.
        IN  MX    10 mail.example.com.

ns1     IN  A     192.0.2.1
ns2     IN  A     192.0.2.2
mail    IN  A     192.0.2.3
www     IN  A     192.0.2.4
ftp     IN  CNAME www.example.com.
```

제어 지시자:
- `$ORIGIN`: 기본 도메인 설정
- `$INCLUDE`: 다른 파일 포함
- `$TTL`: 기본 TTL 설정

---

## 7. 크기 제한

| 항목 | 제한 |
|------|------|
| 라벨 길이 | 63 옥텟 이하 |
| 도메인 명 전체 | 255 옥텟 이하 |
| UDP 메시지 | 512 옥텟 이하 |
| TTL | 32비트 부호 정수 |

---

## 8. 표준 쿼리 처리 예시

`www.example.com`의 A 레코드 조회:

```
1. 클라이언트 → 로컬 리졸버
   "www.example.com의 A 레코드를 찾아줘" (RD=1)

2. 리졸버 → 루트 네임서버 (캐시에 없으면)
   응답: ".com을 담당하는 네임서버는 a.gtld-servers.net"

3. 리졸버 → .com 네임서버
   응답: "example.com을 담당하는 네임서버는 ns1.example.com"

4. 리졸버 → ns1.example.com
   응답: "www.example.com의 A 레코드는 93.184.216.34" (AA=1)

5. 리졸버: 결과 캐싱 (TTL 기간 동안)

6. 리졸버 → 클라이언트
   최종 응답: 93.184.216.34
```

---

## 9. 보안 고려사항

RFC 1035는 기본적인 보안 메커니즘을 포함하지 않습니다. 이후 확장:

- DNSSEC (RFC 4033-4035): 디지털 서명을 통한 응답 인증
- DNS over TLS (RFC 7858): 전송 암호화
- DNS over HTTPS (RFC 8484): HTTPS를 통한 DNS

---

## 10. 관련 RFC

| RFC | 제목 |
|-----|------|
| RFC 1034 | Domain Names - Concepts and Facilities |
| RFC 1035 | Domain Names - Implementation and Specification (본 문서) |
| RFC 2181 | Clarifications to the DNS Specification |
| RFC 3596 | DNS Extensions for IPv6 (AAAA 레코드) |
| RFC 4033-4035 | DNS Security Extensions (DNSSEC) |
