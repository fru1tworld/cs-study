# RFC 8200 - Internet Protocol, Version 6 (IPv6)

> 2017년 7월 발행, RFC 2460을 대체하는 IPv6 표준 명세서
> IPv4의 한계를 극복한 차세대 인터넷 프로토콜

## 1. 개요

RFC 8200은 IPv6 프로토콜의 공식 표준 문서로, 128비트 주소 체계와 단순화된 헤더 구조를 통해 IPv4의 한계를 극복합니다.

### IPv4 대비 주요 개선점

| 특성 | IPv4 | IPv6 |
|------|------|------|
| 주소 크기 | 32비트 | 128비트 |
| 헤더 크기 | 가변 (20-60 바이트) | 고정 40바이트 |
| 체크섬 | 헤더에 포함 | 제거 (상위 계층에서 처리) |
| 단편화 | 라우터에서 수행 가능 | 소스 노드만 수행 |
| 옵션 처리 | 헤더 내 포함 | 확장 헤더로 분리 |

## 2. IPv6 헤더 구조

IPv6 헤더는 고정 40옥텟(320비트)으로 구성됩니다.

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version| Traffic Class |           Flow Label                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Payload Length        |  Next Header  |   Hop Limit   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### 헤더 필드 상세

| 필드 | 크기 | 설명 |
|------|------|------|
| Version | 4비트 | IP 버전 번호 = 6 |
| Traffic Class | 8비트 | 트래픽 관리용 필드 (DiffServ, ECN) |
| Flow Label | 20비트 | 패킷 시퀀스 레이블링 (동일 플로우 식별) |
| Payload Length | 16비트 | IPv6 헤더 이후 데이터 길이 (확장 헤더 포함) |
| Next Header | 8비트 | 다음 헤더 타입 식별자 |
| Hop Limit | 8비트 | 각 노드에서 1씩 감소, 0 도달 시 패킷 폐기 |
| Source Address | 128비트 | 출발지 IPv6 주소 |
| Destination Address | 128비트 | 목적지 IPv6 주소 |

### Traffic Class 필드

```
 0   1   2   3   4   5   6   7
+---+---+---+---+---+---+---+---+
|     DSCP      |  ECN  |
+---+---+---+---+---+---+---+---+
```

- DSCP (6비트): Differentiated Services Code Point (RFC 2474)
- ECN (2비트): Explicit Congestion Notification (RFC 3168)

### Flow Label 필드

> "20비트 Flow Label 필드는 패킷 시퀀스를 네트워크에서 단일 흐름으로 처리하도록 지정합니다."

- 동일 플로우의 패킷들은 같은 Flow Label 값 사용
- 라우터에서 빠른 패킷 분류 가능
- RFC 6437에서 상세 정의

## 3. 확장 헤더 (Extension Headers)

IPv6는 선택적 정보를 별도의 확장 헤더로 분리하여 처리 효율을 높입니다.

> "선택적 정보는 IPv6 헤더와 상위계층 헤더 사이의 별도 헤더에서 인코딩됩니다."

### 정의된 확장 헤더

| Next Header 값 | 확장 헤더 | 설명 |
|----------------|-----------|------|
| 0 | Hop-by-Hop Options | 모든 노드에서 처리 필요 |
| 43 | Routing | 경로 지정 |
| 44 | Fragment | 단편화 정보 |
| 50 | ESP | Encapsulating Security Payload |
| 51 | AH | Authentication Header |
| 60 | Destination Options | 목적지에서만 처리 |
| 59 | No Next Header | 다음 헤더 없음 |

### 권장 헤더 순서

```
IPv6 Header
    ↓
Hop-by-Hop Options Header (있는 경우 반드시 첫 번째)
    ↓
Destination Options Header (라우팅 전 처리용)
    ↓
Routing Header
    ↓
Fragment Header
    ↓
Authentication Header
    ↓
Encapsulating Security Payload Header
    ↓
Destination Options Header (최종 목적지용)
    ↓
Upper-Layer Header (TCP, UDP, ICMPv6 등)
```

### 확장 헤더 일반 포맷

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Next Header  |  Hdr Ext Len  |                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
|                                                               |
.                  Header Specific Data                         .
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

## 4. 옵션 포맷 (TLV 형식)

Hop-by-Hop Options와 Destination Options 헤더는 Type-Length-Value 형식을 사용합니다.

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - - -
|  Option Type  |  Opt Data Len |  Option Data
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - - -
```

### Option Type의 상위 2비트 의미

| 비트 값 | 동작 |
|---------|------|
| 00 | 옵션을 건너뛰고 계속 처리 |
| 01 | 패킷 폐기 |
| 10 | 패킷 폐기 및 ICMP Parameter Problem 전송 |
| 11 | 패킷 폐기 및 조건부 ICMP 전송 (목적지가 멀티캐스트가 아닌 경우에만) |

### 세 번째 비트 의미

| 비트 값 | 의미 |
|---------|------|
| 0 | 라우팅 중 옵션 데이터 변경 없음 |
| 1 | 라우팅 중 옵션 데이터 변경 가능 |

## 5. 단편화 (Fragmentation)

### IPv4와의 핵심 차이점

> "IPv6에서는 소스 노드만 단편화를 수행하며, 라우터는 수행하지 않습니다."

이는 라우터의 처리 부담을 줄이고 성능을 향상시킵니다.

### Fragment Header 구조

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Next Header  |   Reserved    |      Fragment Offset    |Res|M|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Identification                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

| 필드 | 크기 | 설명 |
|------|------|------|
| Next Header | 8비트 | 단편화된 패킷의 원본 Next Header 값 |
| Reserved | 8비트 | 예약됨, 전송 시 0으로 설정 |
| Fragment Offset | 13비트 | 원본 패킷 내 오프셋 (8옥텟 단위) |
| Res | 2비트 | 예약됨 |
| M (More Fragments) | 1비트 | 추가 단편 존재 여부 |
| Identification | 32비트 | 단편 식별값 (소스에서 생성) |

### 단편화 규칙

Per-Fragment 헤더 (모든 단편에 복사):
- IPv6 Header
- Hop-by-Hop Options Header (있는 경우)
- Destination Options Header (라우팅 전)
- Routing Header (있는 경우)

Fragmentable Part (단편화 대상):
- Fragment Header 이후의 모든 데이터
- 각 단편은 8옥텟의 배수여야 함 (마지막 단편 제외)

### 단편화 예시

```
원본 패킷:
+------------------+----------------------+-------------------+
|  Unfragmentable  |    Fragmentable Part (2000 bytes)       |
|     Part         |                                         |
+------------------+----------------------+-------------------+

단편화 후 (MTU 1280):

단편 1:
+------------------+-----------+-------------------------+
|  Unfragmentable  | Fragment  |  First 1232 bytes      |
|     Part         |  Header   |  Offset=0, M=1         |
+------------------+-----------+-------------------------+

단편 2:
+------------------+-----------+-------------------------+
|  Unfragmentable  | Fragment  |  Remaining 768 bytes   |
|     Part         |  Header   |  Offset=154, M=0       |
+------------------+-----------+-------------------------+
```

### 재조립 규칙

- 식별 조건: Source Address + Destination Address + Identification
- 타임아웃: 60초 이내 완료하지 못하면 폐기
- 중복 처리: 정확한 중복 단편은 폐기 가능
- 중첩 금지: 겹치는 단편은 보안상 폐기 (RFC 5722)

## 6. 패킷 크기 이슈

### IPv6 최소 링크 MTU

> "IPv6는 모든 링크가 최소 1280옥텟 이상의 MTU를 가져야 합니다."

### Path MTU Discovery

- RFC 8201에서 정의
- 소스 노드가 경로상의 최소 MTU를 탐색
- 단편화 없이 최적 크기 패킷 전송 가능

### 패킷 크기 요구사항

| 요구사항 | 크기 |
|----------|------|
| 최소 링크 MTU | 1280 옥텟 |
| 권장 최소 MTU | 1500 옥텟 |
| 재조립 후 최소 수용 크기 | 1500 옥텟 |

## 7. 상위 계층 프로토콜 고려사항

### 체크섬 계산

TCP/UDP의 의사 헤더(Pseudo-Header)는 128비트 IPv6 주소를 사용합니다:

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                         Source Address                        +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                      Destination Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Upper-Layer Packet Length                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      zero                     |  Next Header  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### UDP 특이사항

> "IPv6의 기본 동작은 UDP 체크섬이 선택사항이 아닙니다."

- IPv4에서 UDP 체크섬은 선택사항이었음
- IPv6에서는 필수 (IP 헤더 체크섬이 없기 때문)
- 체크섬 계산 결과가 0이면 0xFFFF로 변환

### MSS (Maximum Segment Size) 계산

| 프로토콜 | 헤더 오버헤드 | MSS 계산 |
|----------|---------------|----------|
| IPv4 + TCP | 40 바이트 | Path MTU - 40 |
| IPv6 + TCP | 60 바이트 | Path MTU - 60 |

> "IPv6에서는 최대 패킷 크기에서 60옥텟(IPv6 헤더 40 + TCP 헤더 20)을 빼야 합니다."

## 8. 보안 고려사항

### IPv6의 기본 보안 특성

> "IPv6는 기본 형식과 전송 측면에서 IPv4와 유사한 보안 특성을 가집니다."

가능한 공격:
- 도청 (Eavesdropping)
- 재전송 공격 (Replay)
- 패킷 삽입/삭제/수정
- 중간자 공격 (Man-in-the-middle)
- 서비스 거부 (DoS)

### 보호 메커니즘

- IPsec (RFC 4301): 네트워크 계층 보안
- TLS/SSL: 전송 계층 보안
- SSH: 응용 계층 보안

### RFC 2460 대비 보안 개선사항

| 개선 사항 | 관련 RFC | 설명 |
|-----------|----------|------|
| 원자적 단편 처리 | RFC 6946, 8021 | 단편 관련 공격 방지 |
| 겹치는 단편 필터링 | RFC 5722 | 중첩 단편 기반 우회 공격 차단 |
| 첫 단편 헤더 요구 | RFC 7112 | 방화벽 우회 방지 |
| RH0 제거 | RFC 5095 | Routing Header Type 0 증폭 공격 차단 |

## 9. 주요 변경사항 (RFC 2460 대비)

RFC 8200은 RFC 2460을 대체하며 다음과 같은 주요 변경사항을 포함합니다:

1. 단편화 보안 강화: 겹치는 단편 처리 금지
2. 원자적 단편 처리: 단일 단편 패킷 처리 개선
3. 첫 단편 요구사항: 모든 헤더가 첫 단편에 포함되어야 함
4. RH0 폐기: Routing Header Type 0 사용 금지
5. IPv6 노드 요구사항 통합: 구현 요구사항 명확화

## 10. 요약

RFC 8200은 IPv6의 공식 표준으로 다음을 정의합니다:

- 128비트 주소: 거의 무한한 주소 공간 제공
- 고정 40바이트 헤더: 빠른 처리를 위한 단순화
- 확장 헤더: 유연한 옵션 처리
- 소스 전용 단편화: 라우터 부담 감소
- 강화된 보안: 알려진 취약점 해결

IPv6는 IPv4 주소 고갈 문제를 해결하고, 더 효율적이고 안전한 인터넷 통신을 가능하게 합니다.

## 참고 문서

- RFC 2460: Internet Protocol, Version 6 (대체됨)
- RFC 4291: IPv6 Addressing Architecture
- RFC 4443: ICMPv6
- RFC 4301: Security Architecture for IP
- RFC 6437: IPv6 Flow Label Specification
- RFC 8201: Path MTU Discovery for IPv6
