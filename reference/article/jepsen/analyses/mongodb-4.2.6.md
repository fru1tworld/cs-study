# MongoDB 4.2.6 Jepsen 분석

## 개요
Jepsen이 MongoDB 4.2.6을 평가한 결과, 가장 강력한 읽기/쓰기 설정에서도 스냅샷 격리를 보장하지 못함을 발견했습니다.

## 주요 발견사항

### 1. 약한 기본 설정
- 기본 읽기 관심사: `local` (커밋되지 않은 데이터 관찰 가능)
- 기본 쓰기 관심사: `w:1` (커밋된 쓰기 손실 가능)
- 트랜잭션은 데이터베이스/컬렉션 수준 설정을 무시하고 다시 기본값으로 돌아감

### 2. 스냅샷 격리 미충족
트랜잭션이 다음을 관찰했습니다:
- 읽기 왜곡: 일부 선행 트랜잭션의 효과만 부분적으로 관찰
- 순환 정보 흐름: 트랜잭션이 서로의 쓰기를 상호 관찰
- 중복 쓰기: 배열에 동일 요소가 여러 번 나타남
- 역행적 일관성 위반: 단일 트랜잭션이 자신의 미래 쓰기를 관찰

### 3. 부정확한 마케팅
MongoDB는 "완전한 ACID 트랜잭션"을 주장하지만:
- 스냅샷 격리는 완전한 격리가 아님
- 약 10%의 트랜잭션이 순환 의존성 이상 현상 발생

### 4. 모호한 오류 처리
- `TransactionCoordinatorSteppingDown` 예외는 실제로 커밋되었을 수 있음
- 오류 코드 6은 문서화되지 않음
- 사용자가 성공/실패 여부를 판단하기 어려움

## 권장사항

1. 명시적 설정 필수: 모든 트랜잭션에서 읽기 관심사 `snapshot`과 쓰기 관심사 `majority` 지정
2. 읽기 전용 트랜잭션도 주의: `snapshot`만으로는 충분하지 않으며 `majority` 쓰기 관심사 필요
3. 안전한 기본값 요구: MongoDB는 트랜잭션 기능에 더 보수적인 기본값 채택 필요
4. 마케팅 수정: "완전한 ACID"에서 "스냅샷 격리"로 명확히 변경

## 추가사항
2020년 5월 26일, MongoDB는 트랜잭션 재시도 메커니즘의 버그를 식별했으며 4.2.8에서 패치 예정이라고 발표했습니다.
