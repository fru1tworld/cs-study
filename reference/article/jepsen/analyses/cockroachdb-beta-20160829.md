# CockroachDB beta-20160829 Jepsen 분석

## 개요
이 Jepsen 분석은 하이브리드 논리 클럭과 반동기화된 노드 클럭을 사용하여 직렬화 가능성을 제공하도록 설계된 분산 SQL 데이터베이스 CockroachDB의 일관성 보장을 검토했습니다.

## 주요 결론

일관성 모델: CockroachDB는 엄격한 직렬화 가능성이 아닌 직렬화 가능성을 제공합니다. 단일 키는 선형화 가능성을 달성하지만, 데이터베이스 전체적으로는 다중 키 트랜잭션이 시스템 전체에서 최신 값을 관찰한다고 보장하지 않습니다.

## 발견된 중요한 버그

### 1. 타임스탬프 캐시 충돌 버그
분석 결과 "두 트랜잭션이 동일한 타임스탬프를 가지고 동일한 키에 접근할 때, 트랜잭션 ID를 사용한 구분 없이 동등하게 간주되었습니다." 이로 인해 중복 삽입이 허용되어 직렬화 가능성을 위반했습니다. 이 문제는 "동일한 타임스탬프를 가진 타임스탬프 캐시 항목"이 테이블 간에 덮어쓰일 수 있는 시나리오에서 발생했습니다.

### 2. 이중 적용된 트랜잭션
네트워크 장애로 인해 RPC 재시도 메커니즘이 불확정 결과를 확실한 실패로 변환하여 트랜잭션 상태 머신이 재시도하고 작업을 두 번 적용할 수 있게 했습니다. 연구원들은 "분할 이벤트 중 삽입이 타임아웃되었지만 재시도 시 나중에 중복된" 사례를 문서화했습니다.

## 설계 트레이드오프

CockroachDB는 성능을 위해 의도적으로 엄격한 직렬화 가능성 대신 직렬화 가능성을 선택했습니다. 시스템은 제한된 클럭 동기화(250ms 임계값)에 크게 의존합니다. 이 임계값을 초과하면 모든 보장이 저하됩니다.

## 테스트 결과

은행 이체, G2 이상 현상, 레지스터 작업에 대한 테스트는 모두 제한된 클럭 오프셋으로 통과했습니다. "comments" 테스트는 CockroachDB가 더 오래된 것보다 더 새로운 삽입을 먼저 관찰하는 것을 허용한다는 것을 의도적으로 보여주었습니다—이는 버그가 아니라 문서화된 제한 사항입니다.
