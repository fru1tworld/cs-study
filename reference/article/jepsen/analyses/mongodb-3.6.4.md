# MongoDB 3.6.4 Jepsen 분석

## 개요
Jepsen은 MongoDB 3.6.4의 샤딩 클러스터와 인과 일관성(Causal Consistency)을 검증했습니다. MongoDB의 자금 지원으로 진행되었으며, Jepsen 윤리 정책을 준수했습니다.

## 주요 발견사항

### 샤딩 클러스터
- 선형화 가능성: 다중 샤드 환경에서 "majority" 쓰기와 읽기 시 단일 문서의 선형화 가능한 읽기/쓰기/비교-설정 연산 지원
- 데이터 손실: "journaled" 쓰기 관심사 수준에서는 보장되지 않으며, 테스트 시 6,095건 중 543건의 인정된 쓰기 손실 발생
- 청크 마이그레이션: 네트워크 분할 중에도 안정적으로 작동

### 인과 일관성의 문제점

보고서는 두 가지 주요 이상을 발견했습니다:

1. 쓰기 롤백: 인정된 쓰기가 나중에 사라지는 현상
2. 상태 회귀: 최종 읽기가 초기 상태를 반환

이러한 이상은 "write concern `w1`"과 "read level `local`" 조합에서 발생했습니다.

## 권장사항

보고서는 다음을 강력히 권장합니다:

- 모든 경우에 "majority" 쓰기 사용
- 선형화 가능성이 비용 문제일 때 "majority" 읽기 사용
- 인과 일관성 세션은 "majority/majority" 작업과 함께만 사용
- 클라이언트 간 작업 순서 보장이 필요하면 인과 토큰 전달 고려

## 결론

MongoDB는 이후 문서를 업데이트하여 인과 일관성의 "majority" 요구사항을 명시했습니다. 보고서 저자들은 적절한 설정으로 사용 시 유용한 기능으로 평가합니다.
