# MongoDB 3.4.0-rc3 Jepsen 분석

## 핵심 발견사항

이 보고서는 MongoDB의 복제 프로토콜에서 심각한 데이터 손실 문제를 식별했습니다.

### 프로토콜 v0의 문제점

MongoDB의 원본 복제 프로토콜 v0은 "동기화된 시계에 의존하며, 많은 작업이 동일한 타임스탬프에 도착할 때 왜곡될 수 있습니다."

실제 결과: 4,525건의 삽입 시도 중 93건이 인정되었다가 손실되었습니다. 이는 설계 결함이며, 최신 버전 3.4.1에서도 여전히 발생합니다.

### 프로토콜 v1의 개선사항과 결함

v1은 Raft 알고리즘의 특징을 채택하여 "논리적 용어"를 도입했습니다. 그러나 초기 구현에는 버그가 있었습니다.

- 3.4.0-rc3: 932건 인정된 삽입 중 417건 손실
- 3.4.0-rc4: 여전히 문제 존재
- 3.4.0 이상: 수정됨

## 권장사항

1. v0 사용자: 즉시 v1로 마이그레이션
2. v1 사용자: 3.4.0 이상으로 업그레이드
3. 쓰기 설정: 데이터 보호를 위해 다수(majority) 쓰기 관심 사용
4. 읽기 설정: 선형화 가능 읽기로 부실 읽기와 오래된 읽기 방지

MongoDB 3.4.1 이상은 "모든 삽입된 문서를 보존하고 선형화 가능한 단일 문서 읽기/쓰기 작업을 유지"합니다.
