# Dgraph 1.1.1 Jepsen 분석

## 개요
Jepsen은 2020년 4월 분산 그래프 데이터베이스 Dgraph 1.1.1에 대한 안전성 분석을 수행했습니다. 이전 1.0.2 버전의 모든 문제가 해결되었으나, 새로운 5가지 안전성 문제를 발견했습니다.

## 주요 발견사항

### 다섯 가지 안전성 문제

1. 일시적 누락 값: "읽기에서 존재해야 하는 레코드에 대해 null 값을 반환하는 경우가 관찰되었습니다" (태블릿 이동 직후). 1.1.1-56-ge18986f1c에서 부분 해결되었습니다.

2. 읽기 스큐로 인한 데이터 손상: "태블릿 이동 중 단일 읽기 쿼리가 서로 다른 타임스탬프의 계정 잔액을 관찰"하여 영구적 상태 변화 발생. 아직 미해결 상태입니다.

3. 삽입 기록 손실: "승인된 약 11,544개의 삽입이 최종 읽기에서 나타나지 않았습니다" (1.1.1-59-g191232226에서 해결 가능).

4. 다중 쓰기 입력, 단일 쓰기 출력: 19,030개 값을 삽입했으나 하나만 반환. 최근 빌드에서 해결된 것으로 보입니다.

5. 빈번한 일시적 누락: 몇 천 초마다 한 번 발생하는 일시적 null 값 문제 (미해결).

## 근본 원인
모든 문제가 태블릿 마이그레이션과 관련되어 있습니다. 노드들이 비동기적으로 매핑 변경을 발견하면서 일관성 문제가 발생합니다.

## 권장사항
- Dgraph 1.1.1 이하: 태블릿 이동 중 주의 필요
- 가능하면 유지보수 창 중 수동 마이그레이션 수행
- 마이그레이션 중 트랜잭션 업데이트 중단 권장
- 1.1.2 이상으로 업그레이드 권장
