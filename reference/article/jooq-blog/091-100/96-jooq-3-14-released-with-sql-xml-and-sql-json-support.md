# jOOQ 3.14 릴리스 - SQL/XML 및 SQL/JSON 지원

> 원문: https://blog.jooq.org/jooq-3-14-released-with-sql-xml-and-sql-json-support/

게시일: 2020년 10월 20일 | 작성자: lukaseder

---

## 소개

jOOQ 3.14가 SQL/XML, SQL/JSON, Kotlin 코드 생성, 임베더블 타입, 도메인 타입, 합성 제약 조건, 향상된 MERGE 지원, 그리고 더 많은 SQL 변환 기능을 지원하며 출시되었습니다.

이번 릴리스는 사용자 피드백에 따라 GitHub 이슈들을 정리하고, 더 나은 Kotlin 지원, 임베더블 타입, 도메인 타입 지원 등 가장 많이 요청된 기능들을 마침내 구현했습니다.

---

## XML 및 JSON 지원

표준 SQL은 오랫동안 SQL/XML을 지원해왔고, 최근에는 대부분의 RDBMS도 표준 SQL/JSON 또는 벤더별 변형을 지원합니다. ORDBMS 확장이 그에 걸맞은 채택률을 보지 못한 반면, XML과 JSON은 널리 사용됩니다. 때때로 데이터를 비정규화하여 문서를 데이터베이스에 직접 저장하는 것이 합리적입니다.

### 지원되는 주요 연산자:

* JSON_TABLE - JSON 값을 SQL 테이블로 변환
* JSON_ARRAY, JSON_OBJECT, JSON_VALUE - 값으로부터 JSON 데이터 생성
* JSON_ARRAYAGG, JSON_OBJECTAGG - 데이터를 중첩된 JSON 문서로 집계
* JSON_EXISTS - JSON 경로로 문서 쿼리

XML에도 XMLTABLE, XMLELEMENT, XMLAGG 등 유사한 함수들이 있습니다.

모든 에디션의 jOOQ 3.14는 표준 SQL XML 및 JSON 연산자를 지원하며, 비표준 지원이 가능한 곳에서는 에뮬레이션합니다(예: PostgreSQL 및 SQL Server).

상용 에디션은 SQL Server의 FOR XML 및 FOR JSON API도 지원하며, 다른 곳에서는 표준 연산자를 사용하여 해당 구문을 에뮬레이션합니다.

### 추가적인 JSON/XML 기능:

클래스패스에 Gson, Jackson 또는 JAXB가 있으면 jOOQ가 쿼리 결과의 org.jooq.XML, org.jooq.JSON, org.jooq.JSONB 타입을 중첩된 데이터 구조로 자동 매핑할 수 있습니다.

이러한 접근 방식은 매우 강력합니다. 많은 경우, 미들웨어 레이어의 대부분을 건너뛰고 REST 또는 유사한 엔드포인트를 jOOQ / SQL 쿼리에 직접 바인딩하여 프론트엔드용 JSON을 생성할 수 있습니다.

---

## Kotlin 지원

jOOQ는 오랫동안 일부 Scala 확장과 ScalaGenerator를 지원해왔습니다. Kotlin은 새로운 jOOQ-kotlin 모듈과 KotlinGenerator가 jOOQ/Kotlin 통합에 많은 가치를 더해줄 또 다른 매우 유망한 JVM 언어입니다.

### KotlinGenerator 기능:

* 생성된 POJO에 대한 data class 지원
* 생성된 POJO, 인터페이스 및 레코드에 대한 프로퍼티 지원
* 향상된 널 가능성 지원

### 추가적인 Kotlin 개선 사항:

jOOQ-kotlin 모듈은 jOOQ/Kotlin 통합 경험을 더욱 개선하기 위한 유용한 확장 함수들을 제공합니다.

전체 jOOQ API에 JetBrains의 널 가능성 어노테이션이 추가되었습니다:

* org.jetbrains.annotations.Nullable
* org.jetbrains.annotations.NotNull

이를 통해 Kotlin/jOOQ 코드에서 성가신 T! 타입들이 대부분 제거되고, T 또는 T? 타입으로 변환되어 더 많은 확신을 줍니다.

기존 ScalaGenerator도 비판적으로 검토되어 많은 버그가 수정되었습니다.

---

## 임베더블 타입

jOOQ 3.14의 가장 큰 새 기능 중 하나는 임베더블 타입을 제공하는 JPA에서 영감을 받았습니다. 임베더블 타입은 Oracle과 PostgreSQL에서만 네이티브로 지원되는 데이터베이스 사용자 정의 타입(UDT)의 에뮬레이션입니다. 이러한 타입의 가장 큰 이점은 데이터베이스 스키마에 더 의미론적이고 복합적인 데이터 타입을 생성하고 추가적인 타입 안전성의 이점을 누릴 수 있다는 것입니다.

이 기능의 해석은 주로 소스 코드 생성기에 있으며, 그 출력물은 이제 훨씬 더 가치 있어집니다. 모든 jOOQ 에디션은 컬럼 집합을 패턴 매칭하여 합성 임베더블 타입으로 변환하는 기본 인프라를 지원합니다.

### 상용 에디션 기능:

상용 에디션은 임베더블 타입이 정말 빛을 발하는 경우에 대한 일부 자동 구성을 제공합니다:

* 기본/고유 제약 조건과 일치하는 외래 키
* DOMAIN 타입
* 겹치는 임베더블 타입 처리
* 임베더블 타입이 기본 컬럼을 대체할 수 있도록 허용

jOOQ는 JPA보다 개념을 한 단계 더 발전시켰습니다. jOOQ에서 임베더블 타입은 기본 컬럼을 대체하지 않고 뷰로 작동하거나, JPA처럼 대체로 작동할 수 있습니다. jOOQ는 겹치는 제약 조건을 포함한 모든 수준의 관계형 모델링을 존중하므로 두 임베더블 타입이 겹칠 수 있습니다.

---

## DOMAIN 타입

일부 데이터베이스 방언은 UDT의 더 간단한 형태인 표준 SQL DOMAIN 타입을 지원합니다. VARCHAR(10)과 같은 저수준 기술 타입으로 작업하는 대신, DOMAIN 타입은 단일 컬럼 타입에 이름을 부여하고 재사용 가능한 몇 가지 CHECK 제약 조건을 추가합니다.

### DOMAIN 타입 특성:

* 명명된 타입
* VARCHAR(10)과 같은 기술 타입의 별칭
* DEFAULT 표현식 추가 가능
* NOT NULL 제약 조건 추가 가능
* CHECK 제약 조건 집합 추가 가능

위의 모든 것은 스키마 전체에서 재사용 가능하며, 상용 라이선스가 있는 경우 코드 생성기가 모든 도메인에 대해 임베더블 타입을 자동 생성하여 Java에서 추가적인 타입 안전성의 이점을 누릴 수 있습니다.

---

## 합성 제약 조건

개선된 코드 생성기 출력과 관련하여 이전에 지원되던 합성 기본 키와 이제 합성 고유 키 및 외래 키와 같은 합성 객체가 있습니다.

보안과 데이터베이스 내 재사용 가능한 컴포넌트에 많은 투자를 한다면 SQL 뷰를 많이 사용하게 될 것입니다. 불행히도 뷰에는 외래 키 제약 조건과 같은 메타데이터가 없습니다 - 데이터베이스 설계자인 당신에게는 메타데이터가 "명백"함에도 불구하고 말입니다. 합성 제약 조건을 사용하면 기본 제약 조건에 대한 지식을 jOOQ에 알려줄 수 있습니다.

### 주요 이점:

* 이제 뷰에서도 암시적 조인을 사용할 수 있습니다
* 이제 뷰에서도 JOIN .. ON KEY 구문을 사용할 수 있습니다
* 테이블에서처럼 뷰에서도 임베더블 키 타입을 사용할 수 있습니다

---

## 향상된 MERGE 지원

jOOQ는 마침내 더 고급 MERGE 문 절에 대한 지원을 다루었으며 이제 다음을 지원합니다:

* 여러 WHEN MATCHED AND 조건 THEN UPDATE 절
* 여러 WHEN MATCHED AND 조건 THEN DELETE 절
* UpdatableRecord.merge() 및 레코드 병합을 단순화하는 모든 관련 기능

---

## SQL 변환

파서 및 번역기 도구를 통해 Java에 내장된 DSL 외에 jOOQ를 사용하는 새로운 사용 사례에 대한 투자가 계속됩니다.

번역 기능은 이미 강력했으며, 새로운 SQL 변환 세트를 통해 고객이 RDBMS A에서 RDBMS B로(그리고 실수한 경우 다시 되돌아가는) 마이그레이션하는 데 더욱 강력해졌습니다.

### 새로운 변환 기능:

* ROWNUM을 LIMIT 또는 ROW_NUMBER()로 변환
* 테이블 목록을 ANSI JOIN으로 변환 (Oracle (+) 지원 포함)
* 불필요한 산술 표현식

변환을 위해 만들어진 인프라는 마침내 PostgreSQL의 DISTINCT ON 절을 다른 곳에서 에뮬레이션할 수 있게 했습니다. 웹사이트 번역기는 무료이지만, jOOQ 라이브러리는 프로그래밍 방식으로 또는 명령줄 유틸리티로 사용할 수 있습니다.

---

## 개선된 매뉴얼

jOOQ는 한 발 물러나 문서의 중요한 부분을 검토했습니다. 개선 사항은 다음과 같습니다:

* 코드 생성기 기법에 대한 고정 탭: XML, 프로그래밍 방식 및 Gradle 구성 탭이 접근 방식에 따라 불필요한 정보를 숨깁니다
* 각 함수에 대한 하위 섹션: 이제 각 SQL 함수가 개별적으로 문서화되어 SQL에서 어떻게 작동하는지 예제 및 예제 결과와 함께 설명합니다
* 벤더별 렌더링 예제: 매뉴얼을 생성할 때 jOOQ를 사용하여 jOOQ API 사용법을 지원되는 모든 방언으로 번역하고, 각 방언에서 함수가 어떻게 렌더링되는지 보여줍니다
* imports 표시 버튼: 모든 예제에서 확장 가능한 "show imports" 섹션에 컨텍스트에 맞는 imports를 표시합니다
* 다시 작성된 섹션: 데이터 가져오기 섹션과 같은 일부 섹션이 예제와 함께 훨씬 더 완전해졌습니다
* 새로운 API diff 페이지: Javadoc 링크 측면에서 각 마이너 릴리스 간에 변경된 내용을 표시합니다

---

## 맺음말

이번 릴리스는 복잡한 데이터 타입 처리와 Kotlin과 같은 현대 JVM 언어와의 통합 개선에서 jOOQ 기능의 상당한 발전을 나타냅니다. SQL 변환 인프라와 향상된 문서화는 즉각적인 가치와 향후 개발을 위한 기반을 모두 제공합니다.
