# "생성된 코드를 어디에 놓을까?"에 대한 최종 답변

> 원문: https://blog.jooq.org/look-no-further-the-final-answer-to-where-to-put-generated-code/

게시일: 2014년 9월 8일
작성자: lukaseder

Stack Overflow에서 jOOQ가 왜 생성된 코드를 "/src"가 아닌 "/target"에 넣을 것을 권장하는지에 대한 흥미로운 질문이 있었습니다. 이것은 코드 생성을 수행하는 모든 도구에 적용되는 일반적인 질문입니다:

- jOOQ (데이터베이스 스키마로부터 코드 생성)
- XJC (XSD 파일로부터 코드 생성)
- Hibernate (매핑으로부터 코드 생성)
- Xtend (Xtend 소스로부터 Java 코드 생성)
- XSLT (또는 그 외의 모든 코드/데이터 변환)

사실, Java 컴파일러 자체도 마찬가지입니다. 컴파일러는 고급 언어(.java 파일)에서 저급 언어(.class 파일)로 코드 생성을 수행합니다.

## 생성된 코드를 코드베이스의 일부로 관리하기

이 방법을 사용하면 다음과 같이 합니다:

- 생성된 소스 코드를 버전 관리 시스템에 체크인합니다
- 수동 소스 코드 생성을 사용합니다
- 잠재적으로 부분적인 소스 코드 생성을 사용합니다

이 방법은 다음과 같은 상황에서 특히 유용합니다:

- Java 개발자가 데이터베이스 스키마를 완전히 제어하지 못하거나 전체 접근 권한이 없는 경우. 이 경우 데이터베이스 변경은 외부에서 이루어지며, 생성된 코드를 체크인하면 이러한 변경 사항과 그 부작용을 추적할 수 있습니다.

- 많은 개발자가 동시에 동일한 데이터베이스 스키마에서 작업하고 스키마가 계속 변경되는 경우. 각 변경 사항을 추적하고 그것이 jOOQ 생성 코드에 미치는 영향을 확인하는 것이 유용합니다.

- jOOQ 버전 업그레이드 시 코드 생성기의 동작 변경을 추적하고 싶은 경우. 버전 업그레이드나 코드 생성 구성 변경 시 발생하는 차이를 버전 관리를 통해 확인할 수 있습니다.

이 접근 방식을 사용하면 생성된 코드를 자체 라이프사이클을 가진 외부 라이브러리처럼 취급하게 됩니다.

단점: 이 방법의 단점은 실제 스키마가 생성된 스키마와 동기화되지 않을 수 있어 오류가 발생하기 쉽고 약간 더 많은 작업이 필요하다는 것입니다.

## 생성된 코드를 파생 산출물로 관리하기

이 방법을 사용하면 다음과 같이 합니다:

- 버전 관리 시스템에는 실제 DDL(진정한 원본 소스)만 체크인합니다 (예: Flyway로 관리)
- 스키마가 변경될 때마다 jOOQ 코드를 재생성합니다
- 지속적 통합(CI) 서버를 포함한 모든 머신에서 jOOQ 코드를 재생성합니다

이 방법은 다음과 같은 상황에서 특히 유용합니다:

- Java 개발자가 완전히 제어하는 비교적 작은 데이터베이스 스키마를 가진 경우. 모든 파생 산출물을 재생성하여 품질을 보장하고 싶을 때 적합합니다.

Maven은 이 접근 방식을 `target/generated-sources`와 같은 특별한 디렉터리와 Maven 빌드 라이프사이클의 `generate-sources` 페이즈를 통해 지원합니다:

```xml
<plugin>
    <groupId>org.jooq</groupId>
    <artifactId>jooq-codegen-maven</artifactId>
    <executions>
        <execution>
            <phase>generate-sources</phase>
            <goals>
                <goal>generate</goal>
            </goals>
        </execution>
    </executions>
    <!-- 구성 생략 -->
</plugin>
```

단점: 이 방법의 단점은 데이터베이스의 일부가 일시적으로 사용 불가능한 경우처럼 완전히 허용 가능한 상황에서도 빌드가 실패할 수 있다는 것입니다.

## 실용적인 조합

일부 프로젝트에서는 특정 생성된 코드(예: POJO는 버전 관리에 포함하지만 테이블/레코드는 제외)를 선택적으로 버전 관리하는 하이브리드 전략을 사용합니다. 이는 다음과 같은 방법으로 달성할 수 있습니다:

- 생성기 전략을 사용하여 산출물을 다른 패키지로 재배치
- 서로 다른 구성으로 코드 생성기를 여러 번 실행

## 결론

실망시켜 드려서 죄송합니다. 어느 한 접근 방식이 다른 것보다 낫다는 최종 답변은 없습니다. 여러분의 특정 상황에서 더 많은 가치를 제공하는 방법을 선택하세요.

코드 생성이 처음이라면 먼저 다음 질문들을 고려해 보세요:

- 데이터베이스 스키마에 대한 완전한 제어권이 있습니까?
- 모든 개발자와 CI 환경에서 데이터베이스에 접근할 수 있습니까?
- 스키마 변경 빈도가 얼마나 됩니까?
- 생성된 코드의 변경 사항을 추적하는 것이 중요합니까?

이러한 질문에 대한 답변이 여러분의 프로젝트에 가장 적합한 접근 방식을 결정하는 데 도움이 될 것입니다.
