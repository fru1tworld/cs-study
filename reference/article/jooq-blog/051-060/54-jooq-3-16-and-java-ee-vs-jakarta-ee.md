# jOOQ 3.16과 Java EE vs Jakarta EE

> 원문: https://blog.jooq.org/jooq-3-16-and-java-ee-vs-jakarta-ee/

2022년 2월 14일, lukaseder 작성

Java 생태계 전반에 걸쳐 `javax` 패키지 이름을 `jakarta`로 전환하는 중대한 변화가 일어나고 있다. 이 변화는 기업 및 법적 고려 사항에서 비롯되었지만, 엔지니어링 커뮤니티는 이에 맞춰 적응해야 한다. 이 전환은 jOOQ에도 구체적인 영향을 미친다.

## jOOQ의 Java EE 의존성

jOOQ는 세 가지 Java EE 의존성을 포함하고 있다:

JAXB - 이 의존성은 jOOQ의 코드베이스 전반에 걸쳐 나타나며, 런타임 모듈과 코드 생성 모듈 모두에서 사용된다. 현재 이 API는 선택 사항이 아닌 필수 사항으로 남아 있다. 이 의존성은 세 가지 XML 형식에 대한 마샬링과 언마샬링을 처리한다: 코드 생성 설정, 커스텀 설정, 그리고 정보 스키마 내보내기이다. 코드 생성 설정의 JAXB 어노테이션은 특히 유용한데, 사용자가 XML 파일과 프로그래밍 방식의 설정을 쉽게 병합할 수 있게 해준다. 서드파티 기여인 gradle-jooq-plugin은 이러한 어노테이션을 인트로스펙트하는 데 의존하고 있다.

Java 11에서 JAXB API와 구현체가 제거됨에 따라, jOOQ는 라이브러리의 특정 JAXB 요구 사항을 해결하는 "MiniJAXB" 구현체를 개발했다. 이를 통해 클래스패스에 JAXB 구현체 없이도 동작할 수 있게 되었지만, API 자체는 여전히 필수적이다.

JPA - 이것은 선택적 의존성이다. `DefaultRecordMapper`는 제한된 범위에서 JPA 엔티티에 매핑할 수 있어, JPA에서 jOOQ로의 마이그레이션을 용이하게 하고 어노테이션 기반 매핑을 지원한다. 코드 생성기는 생성된 POJO 클래스에 JPA 어노테이션을 생성할 수 있는데, 이는 실제 엔티티를 만들기 위한 것이 아니라 주로 `DefaultRecordMapper`와의 호환성을 위한 것이다. 이러한 기능들은 논란이 있어 왔으며, Jakarta EE 전환이 이들의 최종적인 제거를 앞당길 수 있다.

Bean Validation - 공식적으로 필수는 아니지만, 코드 생성기가 생성된 POJO의 문자열 필드에 `@Size`와 같은 Bean Validation 어노테이션을 생성할 수 있다. 사용자가 어노테이션 생성을 선택한 경우에만 이 의존성을 접하게 되므로, Jakarta EE 마이그레이션이 이 컴포넌트에 미치는 영향은 미미하다.

## Jakarta EE로의 마이그레이션

세 가지 의존성 모두 jOOQ 3.16에서 이슈 #9641을 통해 Jakarta EE로 마이그레이션되었다. 이 변경은 불가피했는데, 특히 Spring Boot 3.0이 자체 마이그레이션을 발표하면서 개발 빌드에서 jOOQ를 일시적으로 제거한 이후에는 더욱 그러했다(spring-boot#28821). 이 시기가 두 프로젝트의 발전 방향과 맞아떨어졌다.

## 하위 호환성 결정

이 마이그레이션은 Java EE와 Jakarta EE를 동시에 지원하는 것에 대한 중요한 질문을 제기했다. 세 가지 접근 방식이 존재했다:

두 API를 병렬로 지원하는 것은 두 의존성을 모두 포함하는 단일 아티팩트를 배포하거나 여러 아티팩트를 배포하는 방식으로 가능했다. 첫 번째 옵션은 문제를 초래한다 - jOOQ가 기술적으로 두 API를 모두 지원할 수 있지만, 사용자 클래스패스에 둘 다 배치하면 심각한 통합 문제가 발생한다.

여러 아티팩트를 배포하면 사용자가 깔끔하게 선택할 수 있다. 하지만 이 전략을 성공적으로 구현한 프로젝트들은 대체로 Jakarta EE에 대한 강한 의존성을 유지하고 있었다. jOOQ의 이러한 API 사용은 미미한 수준이어서 이러한 복잡성을 정당화하지 못했다. 또한, jOOQ는 이미 다양한 Java 버전과 에디션(Java 8, 11, 17용 Open Source, Trial, Pro 에디션)에 걸쳐 수많은 배포판을 제공하고 있어, 여기에 또 다른 차원을 추가하면 비현실적인 조합이 만들어진다.

궁극적으로, jOOQ는 Jakarta EE로만 전진하기로 결정했다. 버전 3.16부터 이러한 의존성이 적용되는 부분에서 Java EE 지원이 중단되었다.

## 향후 방향

이번 전환은 의존성 관리에 대한 교훈을 강화한다. jOOQ와 같은 라이브러리는 특히 큰 압박을 받는데, 이들의 의존성 선택이 사용자 프로젝트에 직접적인 영향을 미치기 때문이다. jOOQ는 거의 제로 의존성 철학을 유지하고 있지만, Java 11에서 JAXB가 이전에 포함되어 있었음에도 제거된 것과 같은 요인으로 인해 이를 완전히 달성할 수는 없다.

향후 jOOQ 개발은 가능한 한 이러한 의존성을 제거하거나 선택적 플러그인 모듈로 이전하는 것을 목표로 하며, 사용자의 마찰을 줄이고 의존성 관리에 있어 더 큰 유연성을 제공하고자 한다.
