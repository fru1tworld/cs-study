# 야크 쉐이빙은 API를 개선하는 좋은 방법이다

> 원문: https://blog.jooq.org/yak-shaving-is-a-good-way-to-improve-an-api/

Wiktionary에서는 야크 쉐이빙(Yak Shaving)을 다음과 같이 정의한다:

> 야크 쉐이빙 (불가산 명사)
>
> 1. (관용적) 중간 단계의 어려움들을 극복함으로써 더 큰 문제를 해결할 수 있게 해주는, 겉보기에는 쓸모없어 보이는 모든 활동.
> 2. (관용적) 더 크고 유용한 작업을 의식적으로 또는 무의식적으로 미루기 위해 하는 덜 유용한 활동.

두 정의 모두 리팩토링 작업을 정확하게 설명한다.

## 작업

나는 jOOQ 3.6을 위해 Feature #2639: "DEBUG 로그 출력에 저장 프로시저 OUT 값 추가"를 구현하고 싶었다.

이 기능은 DEBUG 로깅이 활성화된 상태에서 저장 프로시저를 실행할 때 OUT 파라미터를 로그에 표시하도록 하는 것이다. 이것은 매우 쉬웠을 것이다. 기존의 `LoggerListener`를 사용하면 단 10줄 정도의 코드만 필요했다.

## 겉보기에 쓸모없어 보이는 활동들

하지만 깔끔하게 구현하려고 하니 네 가지 문제점이 드러났다:

1. jOOQ `Routine`의 `RETURN_VALUE` 메타 정보에 접근할 방법이 없다
2. `Routine`의 IN 및 OUT 값에 일반적으로 쉽게 접근할 방법이 없다
3. OUT 파라미터가 페치될 때를 모델링하는 라이프사이클 이벤트가 없다
4. `Routine` OUT 파라미터를 보기 좋게 포맷팅할 방법이 없다

우회 방법을 구현하는 대신, 나는 이러한 기능들을 공개 API에 추가하기로 결정했다:

1. 공개 `Routine.getReturnParameter()` 메서드 추가
2. 공개 `Routine.getValue()` 및 `setValue()` 메서드 추가
3. OUT 파라미터 페칭을 위한 `ExecuteListener.outStart()` 및 `outEnd()` 라이프사이클 이벤트 추가
4. `Routine`을 `Record`로 볼 수 있는 `Routine.outRecord()` 및 `Routine.inRecord()` 메서드 추가

## 핵심 통찰

"API 구현자는 첫 번째 API 소비자이다."

API를 유지보수하는 사람이 기능을 구현하는 동안 누락된 기능을 발견하면, 사용자들도 비슷한 어려움에 직면할 가능성이 높다. 내부적인 우회 방법을 사용하는 대신 이러한 격차를 공개 API로 노출하면 더 넓은 커뮤니티에 도움이 된다.

이것은 간단한 논리이다: 내가 필요로 했다면, 다른 사람들도 아마 필요로 할 것이다.

## 사용자 피드백의 현실

대부분의 사용자들은 명시적으로 기능을 요청하지 않는다. 그들은 단순히 문제를 우회한다. 대략적으로 사용자들의 행동 패턴을 분류하면:

- 80%의 사용자는 문제에 직면했을 때 그냥 우회 방법을 찾는다
- 그들은 기능 요청에 참여하지 않는다
- 그들은 문제가 있다고 말하지도 않는다

따라서 개발자는 구현 중에 발견하는 격차를 사전에 식별하고 해결해야 한다. 사용자가 명시적으로 요청하지 않더라도, 그 격차는 실제로 존재하며 많은 사람들이 조용히 고통받고 있을 가능성이 높다.

## 결론

작은 기능 요청 하나가 다섯 가지의 실질적인 API 개선을 촉발했다. 이것이 야크 쉐이빙의 힘이다.

"당신이 필요하다면, 그들도 아마 필요할 것이다. 야크 쉐이빙을 시작하라!"
