# jOOQ 화요일: Thorben Janssen이 Hibernate 성능 비밀을 공유하다

> 원문: https://blog.jooq.org/jooq-tuesdays-thorben-janssen-shares-his-hibernate-performance-secrets/

jOOQ 화요일 시리즈에 오신 것을 환영합니다. 이 시리즈에서는 격월로 셋째 주 화요일에 jOOQ 관점에서 흥미롭다고 생각하는 업계 인사를 인터뷰한 글을 게시합니다. 여기에는 SQL, Java, 오픈 소스 및 다양한 관련 주제를 다루는 분들이 포함됩니다.

저는 경력의 대부분을 Hibernate와 함께 일해 온 Thorben Janssen을 만나게 되어 기쁩니다. Thorben은 훌륭한 블로그 thoughts-on-java.org를 운영하고 있으며, Hibernate 성능 튜닝 온라인 교육을 진행하고, 매주 훌륭한 Java Weekly 다이제스트를 큐레이션하고 있습니다.

## 인터뷰

안녕하세요 Thorben - 블로그에서 JPA의 가장 정교한 어노테이션들을 사용한 매우 복잡한 예제들을 다루고 계신 것을 보았습니다. 예를 들어 @SqlResultSetMapping 같은 것들이요. 그런 정교한 어노테이션을 사용한 선언적 프로그래밍 스타일이 원래 의도대로 작동하고 있나요?

좋은 질문이네요. JPA의 선언적 스타일은 분명 장점이 있지만, 몇 가지 문제도 있습니다.

어노테이션은 개발자가 프레임워크를 잘 이해하고 있을 때 복잡한 기능을 단순화하고 상용구 코드(boilerplate code)를 줄여줍니다. 매핑 정의만 제공하면 프레임워크가 구현 세부사항을 처리하기 때문입니다.

하지만 다른 한편으로는, 개발자가 어노테이션의 기능을 완전히 이해하지 못하더라도 온라인에서 코드를 복사해서 사용하기 쉽습니다. 대부분의 경우 동작하긴 할 겁니다. JPA와 Hibernate는 고도로 최적화되어 있고 최적이 아닌 코드도 꽤 잘 처리합니다. 적어도 한 명의 사용자가 로컬 머신에서 테스트할 때까지는요. 하지만 코드가 프로덕션에 배포되고 수백 또는 수천 명의 사용자가 동시에 사용하면 상황이 빠르게 달라집니다.

프로덕션에서만 발생하고 개발자들이 제대로 분석하지 않는 성능 문제가 정말 많습니다.

모든 ORM 사용자들이 JPA/SQL 성능에 대해 알아야 할 세 가지 핵심적인 것을 꼽는다면 무엇일까요?

세 가지만요? 까다로운 질문이네요. 그렇다면 가장 중요한 세 가지는:

1. 단연코 가장 중요한 것은 여러분의 ORM 프레임워크가 관계형 데이터베이스에 데이터를 저장하기 위해 SQL을 사용한다는 것을 기억하는 것입니다. 당연하게 들리겠지만, 많은 개발자들이 이것을 잊고 실행된 SQL 문을 분석하고 최적화하려 하지 않습니다. 이 SQL 문은 성능 문제의 원인인 경우가 많습니다. 또한 문제가 있는지 확인하는 좋은 방법이기도 합니다. 예를 들어, 처음에 말씀하신 정교한 어노테이션들이 제대로 작동하는지 확인하거나 유명한 n+1 select 문제가 발생하는지 확인하는 데 말이죠.

2. 두 번째는 모든 프레임워크가 모든 문제에 잘 맞는 것은 아니라는 점입니다. JPA와 Hibernate는 데이터를 생성하거나 업데이트하거나 쿼리가 너무 복잡하지 않은 경우에 좋은 솔루션입니다. 하지만 복잡한 보고서를 생성해야 하거나 데이터 마이닝 작업을 수행해야 한다면 좋은 선택이 아닙니다. 그런 경우에는 네이티브 SQL 쿼리나 jOOQ 같은 다른 프레임워크로 전환하는 것을 고려해야 합니다.

3. 세 번째 권장사항은 엔티티 간의 관계에 지연 로딩(lazy fetching)을 사용하는 것입니다. 이렇게 하면 사용하지 않는 관계의 데이터를 가져오기 위한 추가 SQL 쿼리가 생성되지 않습니다. 그런 다음 관계를 사용해야 한다면 FETCH JOIN 문이나 엔티티 그래프를 사용하여 초기 쿼리와 함께 관계를 초기화할 수 있습니다.

교육에서 EclipseLink나 OpenJPA 또는 jOOQ 등이 아닌 Hibernate만 다루는 이유가 있나요?

간단한 이유가 있습니다: 15년 넘게 다양한 프로젝트에서 Hibernate를 전문적으로 사용해 왔습니다. 그래서 제가 가장 잘 알고 있는 것이고, 개발자들이 저에게 조언을 구하는 것이죠.

그리고 몇 달 전에 제 독자들에게 사용하는 JPA 구현체에 대해 설문조사를 했는데, 대부분이 순수 JPA나 Hibernate를 사용하고 있었고 소수만이 EclipseLink나 다른 JPA 구현체를 사용하고 있었습니다.

jOOQ는 흥미롭습니다! Hibernate가 좋은 선택이 아닌 복잡한 쿼리 시나리오를 더 잘 처리하기 위한 방법으로 향후 교육에 통합하는 것을 고려하고 있습니다.

전통적인 교실 교육 대신 온라인 교육의 장점은 무엇인가요?

일반적인 교실 교육에서는 참가자들이 교육 장소까지 여행해야 합니다. 운 좋게 대도시에 산다면 대부분의 교육이 근처에서 진행되겠지만, 모든 사람이 그런 것은 아닙니다. 그래서 많은 사람들이 여행을 해야 하고, 그것은 비용이 들고 시간이 걸리며 스트레스를 줍니다.

온라인 교육의 장점은 여행 없이 교실 교육과 동일한 이점을 대부분 제공한다는 것입니다. 비디오 콘텐츠, 연습 문제, 포럼, 그룹 코칭 콜이 있어서 참가자들은 자신의 사무실이나 집에서 현재 프로젝트에 너무 지장을 주지 않으면서 교육을 완료할 수 있습니다.

Java Weekly 다이제스트로 많은 콘텐츠를 읽게 되셨을 텐데요. 그 경험에서 가장 큰 통찰은 무엇인가요?

Java Weekly 다이제스트를 시작하기 전에는 경험 많은 개발자들의 훌륭한 기술 블로그가 얼마나 많은지 몰랐습니다.

인기 있는 블로그와 웹사이트들은 대부분 이미 알려져 있고 쉽게 찾을 수 있습니다. 하지만 그 외에도 자신의 경험과 지식을 공유하는 뛰어난 콘텐츠를 작성하는 많은 사람들이 있습니다. 저는 Java 생태계 전반에 대해 정말 많은 것을 배웠습니다.
