# jOOQ 화요일: Richard North가 Testcontainers로 데이터베이스 테스트의 재현성을 높이다

> 원문: https://blog.jooq.org/jooq-tuesdays-richard-north-makes-database-testing-more-reproducible-with-testcontainers/

jOOQ 화요일 시리즈에 오신 것을 환영합니다. 이 시리즈에서는 격월로 셋째 주 화요일에 jOOQ 관점에서 흥미롭다고 생각하는 업계 인사를 인터뷰한 글을 게시합니다. 여기에는 SQL, Java, 오픈 소스 및 다양한 관련 주제를 다루는 분들이 포함됩니다.

오늘은 데이터베이스 및 UI 테스트 도구인 Testcontainers의 창시자 Richard North를 소개하게 되어 매우 기쁩니다.

## 인터뷰

Skyscanner에서 일하고 계신데요. 데이터를 다루는 일에서 가장 흥미로운 점은 무엇인가요?

Skyscanner는 모든 의사결정 수준에서 데이터 주도적인 회사입니다. 우리는 사용자들에게 더 나은 서비스를 제공하기 위해 방대한 양의 여행 정보를 처리합니다. 특히 목적지 추천 시스템이 흥미로운데, 이 시스템은 데이터, 알고리즘, 실험을 기반으로 사람들이 새로운 여행지를 발견할 수 있도록 도와줍니다. 여행 추천은 미디어 추천과는 다릅니다 - 책이나 노래보다 여행지의 수는 적지만, 사용자의 선호도는 미묘하고 다양합니다. 또한 분석 수집과 개선을 위한 실험 실행을 포함한 상당한 규모의 데이터 인프라 작업도 수행하고 있습니다.

Testcontainers를 만든 이유는 무엇인가요? 어떤 문제를 해결하려고 했나요?

Testcontainers는 테스트 환경의 재현성(reproducibility)이라는 하나의 주제로 통합되는 여러 문제를 해결합니다. 제 JVM 개발 경험 전반에 걸쳐, 복잡성, 불안정성, 유지보수 오버헤드를 가장 많이 야기한 것은 항상 비-JVM 의존성이었습니다. 저는 첫 출근 날 테스트를 실행하기 위해 이틀간의 설정 작업이 필요했던 것을 기억합니다. 나중에 CI 서버를 구축할 때도 이 과정을 반복해야 했습니다.

Docker가 개발자들에게 운영 환경과의 동등성(prod-parity)을 개선해 주었습니다. Testcontainers는 Docker의 모든 힘을 JVM 통합 테스트에 가져오려는 제 노력에서 탄생했습니다. 특히 깨끗하고 대표적인 데이터베이스와 재현 가능한 Selenium 브라우저 테스트를 위해서 말이죠.

H2와 같은 데이터베이스를 에뮬레이션하는 것의 단점은 무엇인가요?

H2는 환상적인 작업물이라고 인정합니다. 하지만 실제 데이터베이스와의 호환성 문제가 있습니다. 2015년에 우리 팀은 H2에서 동등한 기능이 없는 MySQL 기능들과 씨름해야 했고, 구현에 제약이 생겼습니다. 이 격차가 Testcontainers를 만들게 된 계기가 되었습니다 - Docker 기반 데이터베이스 컨테이너에 대한 파사드(facade)를 생성하는 것이죠.

다양한 계층에서의 데이터베이스 모킹(mocking)에 대해 어떻게 생각하시나요?

통합 테스트 도구를 만들었지만, 모순적으로 들릴 수 있어도 저는 모의 객체(mock)를 사용하는 작고 가볍고 계층화된 테스트를 지지합니다. 중요한 것은 거짓 가정이 아닌 현실에 대해 실제 동작을 테스트하는 것입니다.

자신이 작성한 코드를 모킹하는 것은 잘 작동하지만, 외부 컴포넌트의 모의 객체는 기능 추가나 스키마(schema) 변경과 같은 데이터베이스 복잡성 이후에 구식이 될 수 있습니다. 제가 생각하는 이상적인 접근 방식은: 상위 계층에서 소비하는 데이터 접근 계층(data access layer)은 모킹하되, 데이터 접근 계층 자체는 실제 데이터베이스에 대해 테스트하는 것입니다. 이것이 바로 Testcontainers가 용이하게 해주는 부분입니다.

가장 큰 테스트 도전 과제는 무엇이었나요?

모바일 앱 테스트, 특히 iOS가 제가 직면한 가장 어려운 도전이었습니다. 저는 모바일 개발을 즐기지만, 서버 측 작업에 비해 구시대적으로 느껴집니다. 비동기성(asynchronicity)과 테스트 가능한 소프트웨어 구조를 복잡하게 만드는 플랫폼 API 등의 도전이 있습니다. 도구 지원이 상당히 뒤처져 있어서 자동화된 테스트에 대한 투자를 꺼리게 됩니다 - 그 입증된 가치를 고려하면 문제적인 상황입니다.

최근에는 개선이 이루어지고 있지만, 저는 서버 측 JVM 테스트를 훨씬 더 선호합니다. 그 영역에서 개발자들이 상대적으로 행운아라는 것을 인정합니다.
