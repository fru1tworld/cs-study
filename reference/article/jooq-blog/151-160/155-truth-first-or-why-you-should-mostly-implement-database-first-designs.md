# 진실 우선, 또는 왜 대부분 데이터베이스 우선 설계를 구현해야 하는가

> 원문: https://blog.jooq.org/truth-first-or-why-you-should-mostly-implement-database-first-designs/

이 글은 애플리케이션 개발에서 Java 우선(또는 언어 우선) 접근 방식보다 데이터베이스 우선 설계 접근 방식을 옹호합니다.

## 코드 생성에 대한 회의론의 핵심 문제

일부 개발자들은 jOOQ가 소스 코드 생성에 의존한다는 점에 저항감을 보입니다. 하지만 이러한 저항은 근거가 없습니다. "명세, 데이터 모델 등과 같은 진실(내부적이든 외부적이든)이 존재합니다." 코드 생성은 단순히 그 진실의 로컬 표현을 프로그래밍 언어로 생성하는 것입니다.

컴파일러가 소스 코드에서 바이트코드를 생성하는 것처럼, 코드 생성은 "진실"을 다른 언어로 번역하는 필수적인 과정입니다. "내부 또는 외부 진실의 로컬 표현을 직접 손으로 작성하는 것은 전혀 의미가 없습니다."

## Java 우선(Hibernate) 접근 방식이 장기적으로 실패하는 이유

Hibernate는 개발자가 먼저 엔티티를 정의하고 데이터베이스 스키마가 자동으로 생성되도록 허용하여 초기 개발을 편리하게 만듭니다. 하지만 이 접근 방식은 프로덕션 이후 심각한 문제를 야기합니다.

개발 중에는 스키마를 버리고 재생성하는 것이 잘 작동합니다. 하지만 라이브 시스템이 데이터를 축적하면, "더 이상 데이터베이스를 버릴 수 없게 됩니다. 데이터베이스가 레거시가 되었기 때문입니다."

이로 인해 수동 DDL 마이그레이션과 엔티티 동기화가 필요해지며, 작업량이 두 배로 늘어나고 불일치가 발생합니다. 마이그레이션 스크립트와 함께 수동으로 엔티티를 업데이트해야 하는 패턴은 기술 부채를 만들어냅니다.

## 데이터베이스 주권 원칙

데이터베이스는 스키마 정의의 단일 진실 공급원(Single Source of Truth)이어야 합니다. 모든 클라이언트는 코드 생성을 통해 파생된 복사본을 유지합니다. 이는 여러 애플리케이션 간의 일관성을 보장하고, "'진실'이 모든 곳에 있으면서 동시에 아무 곳에도 없는" 복잡한 상황을 방지합니다.

Flyway와 같은 도구를 사용한 체계적인 DDL 마이그레이션이 ORM이 생성한 스키마보다 훨씬 바람직합니다.

## 코드 생성의 가치

데이터베이스 우선 설계와 코드 생성을 결합하면 다음과 같은 이점이 있습니다:

- 자동 클라이언트 모델 업데이트: 스키마가 변경되면 자동으로 반영됨
- 타입 안전 컴파일: 영향받는 코드를 컴파일 시점에 포착
- 적절한 인덱싱과 벤더별 최적화: 데이터베이스 특성에 맞는 최적화 가능
- 단순화된 장기 유지보수: 빌드 파이프라인에 대한 초기 투자가 수년간의 생산성 향상으로 보상됨

데이터베이스 메타데이터는 모든 주요 시스템에서 SQL을 통해 쿼리할 수 있습니다. 코드 생성기는 현재 스키마를 반영하는 jOOQ 클래스, JPA 엔티티 또는 상수를 자동으로 생성할 수 있습니다. 스키마 변경은 클라이언트 코드에서 컴파일 오류로 자동 전파됩니다.

## 예외 상황

데이터베이스 우선 접근 방식이 보편적이지 않은 경우도 있습니다:

- 알 수 없는 스키마: 스키마 검색 도구가 필요한 경우
- 동적 스키마 생성: 엔티티-속성-값(Entity-Attribute-Value) 패턴을 사용하는 시스템처럼 고정 스키마가 적용되지 않는 경우

하지만 이러한 경우는 예외적인 상황으로 남아 있습니다.

## 핵심 요약

코드 생성을 지원하는 빌드 파이프라인 인프라에 미리 투자하세요. 초기 오버헤드는 수년간의 향상된 생산성과 유지보수성을 통해 배당금으로 돌아옵니다.
