# FlexyPool을 활용한 동적 커넥션 풀 크기 조정에 대기열 이론 적용하기

> 원문: https://blog.jooq.org/applying-queueing-theory-to-dynamic-connection-pool-sizing-with-flexypool/

이 글은 Vlad Mihalcea가 작성한 것으로, 대기열 이론(Queueing Theory) 원리를 활용하여 엔터프라이즈 시스템에서 데이터베이스 커넥션 풀 크기를 최적화하는 방법을 탐구합니다. 저자는 커넥션 풀을 모니터링하고 동적으로 조정하는 오픈소스 DataSource 프록시인 FlexyPool을 개발했습니다.

## 문제점

엔터프라이즈 시스템은 여러 애플리케이션 노드에 걸쳐 데이터베이스 커넥션을 신중하게 할당해야 합니다. 적절한 크기 조정 없이는 트래픽 급증 시 커넥션이 고갈되거나, 시스템이 충분히 활용되지 않는 상황이 발생할 수 있습니다.

## 해결책

순수한 얼랭 대기열 공식(Erlang Queueing Formula)을 적용하는 것은 실용적이지 않다는 것이 증명되었습니다. Mihalcea가 설명하듯이, "Percona 팀조차도 MySQL 커넥션 수를 조정하기 위해 얼랭 공식을 적용하려 했지만, 이것이 실현 가능하지 않다는 것을 깨달았습니다."

대신 저자는 피드백 기반 모니터링 시스템을 구축했습니다.

## FlexyPool 기능

이 도구는 다음과 같은 포괄적인 메트릭을 모니터링합니다:

- 동시 커넥션 수 및 히스토그램
- 커넥션 획득 시간(Connection Acquisition Time)
- 커넥션 임대 기간(Connection Lease Duration) - 장시간 실행되는 트랜잭션 식별
- 오버플로우 풀 용량

FlexyPool은 여러 커넥션 풀 구현체를 지원합니다:

- HikariCP
- C3P0
- DBCP
- Tomcat CP
- 기타 다양한 풀

또한 Graphite, Grafana와 같은 모니터링 플랫폼과 통합됩니다.

## 실제 적용

정적인 계산 대신, FlexyPool은 지속적인 측정과 실시간 조정을 가능하게 합니다. 들어오는 트래픽으로 인해 커넥션 획득 타임아웃이 발생하면, 시스템은 오버플로우 버퍼를 사용하여 최대 용량을 초과하여 풀을 자동으로 확장할 수 있습니다. 이 기능은 독립형 풀에 적용 가능하며, Java EE 관리형 데이터소스에는 적용되지 않습니다.

## 결론

Mihalcea는 "기반이 되는 데이터베이스 커넥션 사용량을 모니터링하는 것은 진화하는 엔터프라이즈 시스템에서 매우 중요한 메트릭"이라고 강조하며, 동적 조정 도구가 성능 유지에 필수적이라고 말합니다.
