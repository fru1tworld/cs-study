# MongoDB "번개처럼 빠른 집계"를 Oracle로 도전하다

> 원문: https://blog.jooq.org/mongodb-lightning-fast-aggregation-challenged-with-oracle/

이 글은 MongoDB와 Oracle의 5천만 건 데이터셋에 대한 집계 쿼리 성능을 비교하며, MongoDB의 "번개처럼 빠른 속도" 주장에 도전합니다.

## 핵심 논점

저자는 "번개처럼 빠른" 집계 주장이 실제로 데이터베이스 확장 능력을 대표하는지 의문을 제기합니다. 이 글은 "SQL은 확장되지 않는다"는 반면 "NoSQL은 확장된다"는 NoSQL 마케팅 서사에 반박합니다.

## MongoDB 벤치마크

Vlad Mihalcea는 MongoDB의 집계 파이프라인을 사용하여 무작위 타임스탬프와 float 값을 가진 5천만 건의 레코드를 집계했습니다. 연도와 일수(day-of-year)로 그룹화하면서 count, 평균, 최솟값, 최댓값을 계산했습니다. 이 작업은 129초가 걸렸습니다.

## Oracle의 응답

저자는 동일한 데이터셋을 Oracle XE 11gR2에 가져와서 동등한 SQL 쿼리를 실행했습니다:

```sql
SELECT
  EXTRACT(YEAR FROM created_on),
  TO_CHAR(created_on, 'DDD'),
  COUNT(*),
  AVG(value),
  MIN(value),
  MAX(value)
FROM aggregation_test
GROUP BY
  EXTRACT(YEAR FROM created_on),
  TO_CHAR(created_on, 'DDD')
ORDER BY
  EXTRACT(YEAR FROM created_on),
  TO_CHAR(created_on, 'DDD')
```

결과: 32초 - 전체 테이블 스캔으로 초기 실행 시.

## 인덱싱을 통한 최적화

`(created_on, value)`에 커버링 인덱스를 생성한 후, 필터링된 데이터셋(단일 시간)에 대한 동일 쿼리 실행 결과:
- 첫 번째 실행: 0.5초
- 캐시된 실행: 0.005초

실행 계획은 인덱스 전용 스캔을 보여주며, 테이블 접근이 필요하지 않았습니다.

## 주요 발견 사항

### 1. 사과와 오렌지 비교

벤치마크는 서로 다른 하드웨어를 사용했습니다(MongoDB는 SSD, Oracle은 HDD). 또한 프로덕션을 대표하지 않았습니다. 저자는 자신의 CPU가 원래 벤치마크 시스템보다 우수했다고 언급합니다.

### 2. SQL과 NoSQL 모두 확장된다

이 글은 확장성 논쟁을 "FUD(공포, 불확실성, 의심)"로 규정하며, 적절한 튜닝을 통해 두 데이터베이스 유형 모두 대용량 데이터셋을 효과적으로 처리할 수 있다고 주장합니다.

### 3. 데이터 크기에 대한 관점

"5천만 건은 '빅데이터'가 아닙니다. 그냥 평범한 데이터베이스 테이블입니다." 저자는 CERN, Google, Facebook을 진정한 빅데이터 운영자로 언급합니다.

### 4. 성능 맥락

이 글은 사용자 대면 쿼리에서 200ms가 "빠르지 않다"고 일축하며, 여러 동시 쿼리가 사용자 경험을 크게 저하시킬 것이라고 지적합니다.

## 결론

저자는 SQL 데이터베이스를 성급하게 포기하지 말 것을 조언하며, 정보에 입각한 결정은 벤더 마케팅 주장이 아닌 실제 워크로드 요구 사항을 이해하는 것이 필요하다고 강조합니다.

## 댓글 섹션 하이라이트

Vlad Mihalcea는 나중에 데이터 모델링 개선을 통해 MongoDB를 최적화하여 0.0366ms 실행 시간을 달성했습니다. 하지만 하드웨어 차이는 여전히 혼란 변수로 남아있었습니다. 두 참가자 모두 이 실습이 "목표가 아니라 여정"임을 보여주었다고 인정했습니다.

---

## 핵심 요약

| 테스트 시나리오 | MongoDB | Oracle |
|----------------|---------|--------|
| 전체 테이블 집계 (5천만 건) | 129초 | 32초 |
| 필터링된 집계 (단일 시간) | 209ms | 0.5초 (첫 실행) |
| 커버링 인덱스 + 캐시 | - | 0.005초 |

이 비교는 적절한 인덱싱과 데이터베이스 튜닝이 결과에 크게 영향을 미친다는 것을 보여줍니다. Oracle의 우수한 성능은 본질적인 아키텍처 장점이 아닌 전략적 최적화를 통해 나타났습니다.
