# Tailscale과 Indent를 활용한 프로덕션 환경의 고객 데이터 보안

저자: Stevan Arychuk, Reclaim.ai 정보 보안 및 사이트 신뢰성 엔지니어링 책임자

게시일: 2023년 5월 9일

---

## 소개

Reclaim.ai는 개인 식별 정보(PII)와 Google 캘린더 데이터를 처리하여 전 세계 20,000명 이상의 고객에게 서비스를 제공하는 캘린더 어시스턴트입니다. 회사는 개발, 스테이징, 프로덕션 환경을 위한 별도의 AWS 계정을 유지하며, 고객 데이터는 Aurora Postgres 데이터베이스에만 저장됩니다.

조직은 세 가지 핵심 기능을 갖춘 네트워킹 솔루션을 찾고 있었습니다: 간단한 구성, 최소한의 접근 권한 프로비저닝 지연 시간, 그리고 기존 개발자 워크플로우와의 원활한 통합.

---

## 데이터 계층 보안

### Tailscale 구현

회사는 별도의 AWS 계정에 노드를 설치하여 개발, 스테이징, 프로덕션용 AWS 환경 전반에 개별 Tailscale 릴레이를 배포했습니다. 각 노드는 해당 VPC 서브넷의 트래픽을 광고하고 라우팅하여, 개발자들이 노트북 설치를 통해 네트워크에 안전하게 접근할 수 있도록 합니다.

"ECS 워크로드, 데이터베이스, AWS 서비스를 포함한" 각 환경의 "모든 것이 Tailscale의 접근 제어(ACL)를 사용하여 추가로 잠겨 있습니다."

이 배포 모델은 특정 기술적 과제를 해결합니다: AWS 관리형 NAT 게이트웨이는 UDP 트래픽을 차단하는데, 이는 Tailscale의 직접 UDP 기능과 충돌합니다. 전용 노드를 통해 트래픽을 라우팅하면 대역폭 비용을 관리하고 구성 가능한 보안 정책을 활성화하면서 이 문제를 해결할 수 있습니다.

---

## 이전의 과제: 수동 접근 관리

자동화된 솔루션을 구현하기 전, Reclaim.ai는 수동 워크플로우를 따랐습니다:

1. 엔지니어가 Slack 또는 이메일을 통해 프로덕션 접근을 요청
2. 보안 리더십이 요청을 검토하고 승인
3. ACL을 수동으로 업데이트 (초기에는 curl 명령어로, 이후에는 GitHub Actions 또는 Infrastructure-as-Code 도구를 통해)
4. 캘린더 알림으로 접근 권한 취소 시점 추적
5. 지정된 기간 후 ACL에서 수동 제거

"무한히 확장 가능한 완벽한 프로세스였습니다. /s" (역자 주: /s는 인터넷에서 풍자를 나타내는 표현)

문제점:

- 접근 권한 프로비저닝에 몇 시간 또는 며칠의 지연 발생
- 접근 권한이 필요 이상으로 오래 활성화되어 위협 표면 확대
- 수동 프로세스가 모든 관련 당사자에게 관리적 마찰 야기

---

## 온디맨드 프로덕션 접근 솔루션

### Indent 통합

회사는 Tailscale과의 네이티브 OAuth 통합과 포괄적인 접근 수명 주기 자동화를 제공하기 때문에 Indent를 선택했습니다. 새로운 워크플로우는 다음과 같이 작동합니다:

1. 엔지니어가 브라우저(`access.new`), 터미널 명령어, 또는 Slack(`/access`)을 통해 필요한 리소스, 사유, 기간을 명시하여 접근을 요청
2. 구성된 승인자가 Slack 알림을 받고 수정 가능한 기간 허용과 함께 요청을 승인/거부
3. 승인 시 Indent가 사용자를 적절한 ACL에 추가; Tailscale이 사용자 디바이스로부터의 트래픽 허용
4. 승인된 기간이 만료되면 Indent가 ACL에서 사용자를 제거하여 접근 권한 취소

"전체 수명 주기 동안 Indent는 감사 증거를 수집하며, 이를 클릭 한 번으로 내보낼 수 있습니다."

### 자동 승인 개선

회사는 이 워크플로우에 PagerDuty를 통합하여, 온콜 엔지니어가 관리자 에스컬레이션 없이 자동으로 접근 승인을 받을 수 있도록 했습니다.

---

## 온디맨드 접근 제공업체 평가 기준

솔루션 선택 시 우선순위로 고려해야 할 사항:

1. 개별 워크플로우 설정을 피하는 규칙/정책 기반 구성
2. 기존 DevOps 도구와의 통합
3. 자동화된 프로비저닝 및 취소 로직 (양방향 모두 동등하게 중요)
4. 일상적인 개발자 워크플로우에 적합한 사용자 경험 품질
5. 규정 준수 감사 증거 생성, 이상적으로는 API 통합을 통해

---

## 입증된 이점

### 성능 개선

엔지니어들은 이제 평균 약 6초 만에 프로덕션 접근 권한을 얻습니다. 특히 "리더십을 포함한 회사 내 어느 누구도" 고객 데이터에 대한 영구적인 무제한 접근 권한을 유지하지 않습니다.

### 규정 준수 이점

이 구현은 기본적으로 규정 준수를 달성합니다—접근은 예외 없이 명시적 승인을 필요로 합니다. Indent의 정책 기반 구성은 승인자와 기간이 규정 준수 통제와 일치하도록 보장합니다. 자동화된 증거 생성은 감사 준비 부담을 크게 줄여줍니다.

### 보안 강화

시스템은 세 가지 보호 계층을 제공합니다:

- 사고 방지: 승인 프로세스가 코드 리뷰처럼 기능하여 요청된 리소스가 명시된 필요와 일치하는지 검증
- 남용 방지: 필수 사유 기재가 무분별하거나 무단 접근 시도를 억제
- 공격 방지: 상시 프로덕션 접근 권한 제거로 침해 결과 감소, CircleCI의 2023년 보안 침해와 같은 사건에서 확인된 취약점 해결

---

## 결론

"온디맨드 비영구적 고객 데이터 접근을 구현함으로써, 우리의 경우 Tailscale과 Indent의 기술을 활용하여," 조직은 프로덕션 환경과 고객 데이터를 보호하면서 운영 속도를 유지할 수 있습니다. 이 접근 방식은 규정 준수 체크박스 완료가 아닌 정보 보안에 대한 진정한 의지를 반영합니다.

---

참고: 이 글에는 CircleCI가 2023년 1월 보안 사고에 대해 투명하게 공개한 것을 인정하는 참조가 포함되어 있습니다.

---

원문 출처: https://tailscale.com/blog/securing-customer-data-tailscale-indent
