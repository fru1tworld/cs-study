# 04 성능 모니터링과 고장 처리 도구

## JDK 명령줄 도구

### jps (Java Process Status)

JVM 프로세스 상태 확인

주요 옵션:

- `-l`: 전체 클래스명 출력
- `-v`: JVM 매개변수 출력
- `-m`: main 메서드 인수 출력

### jstat (Java Statistics Monitoring Tool)

JVM 통계 정보 모니터링

주요 기능:

- 클래스 로딩 통계
- 가비지 컬렉션 통계
- JIT 컴파일 통계
- 메모리 사용 현황

주요 옵션:

- `gcutil`: GC 상황 요약
- `gc`: GC 힙 상황
- `gccause`: GC 원인 포함
- `gcnew`: 신세대 상황
- `gcold`: 구세대 상황

### jinfo (Java Configuration Info)

JVM 설정 정보 조회 및 수정

주요 기능:

- 시스템 속성 조회
- JVM 매개변수 조회
- 런타임에 일부 매개변수 수정

### jmap (Java Memory Map)

메모리 맵 정보 출력

주요 기능:

- 힙 덤프 생성
- 클래스 로더 통계
- Finalize 대기 객체

주요 옵션:

- `-dump`: 힙 덤프 생성
- `-heap`: 힙 상세 정보
- `-histo`: 히스토그램 출력

### jhat (Java Heap Analysis Tool)

힙 덤프 파일 분석

기능:

- 힙 덤프 웹 인터페이스 제공
- 객체 쿼리
- OQL 지원

### jstack (Java Stack Trace)

스레드 스냅샷 생성

주요 기능:

- 스레드 상태 확인
- 데드락 감지
- CPU 사용률 높은 스레드 추적

주요 옵션:

- `-l`: 추가 잠금 정보
- `-F`: 강제 덤프

## 시각화 도구

### JConsole

JMX 기반 관리 콘솔

주요 기능:

- 메모리 모니터링
- 스레드 모니터링
- 클래스 로딩
- MBean 관리

### VisualVM

올인원 문제 해결 도구

주요 기능:

- 프로파일링
- 힙 덤프 분석
- 스레드 덤프
- 플러그인 확장

### Java Mission Control

상용급 모니터링 도구

주요 기능:

- Java Flight Recorder
- 저오버헤드 프로파일링
- 고급 분석 기능
- 실시간 모니터링

## 성능 분석 방법론

### 1. 문제 정의

- 증상 파악
- 재현 조건
- 영향 범위
- 우선순위

### 2. 데이터 수집

- 로그 분석
- 메트릭 수집
- 프로파일링
- 힙/스레드 덤프

### 3. 분석

- 병목 지점 식별
- 근본 원인 분석
- 패턴 파악
- 가설 수립

### 4. 해결

- 최적화 적용
- 성능 테스트
- 효과 검증
- 문서화

## 일반적인 성능 문제

### 메모리 누수

증상: OOM, GC 빈번

분석:

- 힙 덤프 분석
- 메모리 증가 추세
- Retained 힙 확인

해결:

- 참조 제거
- 캐시 정리
- 리소스 해제

### CPU 과다 사용

증상: 응답 지연, 높은 CPU 사용률

분석:

- 스레드 덤프
- 프로파일링
- 핫스팟 식별

해결:

- 알고리즘 최적화
- 병렬화
- 캐싱

### 데드락

증상: 프로그램 멈춤

분석:

- 스레드 덤프
- 잠금 의존성
- 대기 체인

해결:

- 잠금 순서 통일
- 타임아웃 설정
- 재설계

## 교훈

1. **적절한 도구 선택이 중요하다**
2. **정기적인 모니터링을 수행하라**
3. **문제 발생 전에 베이스라인을 수립하라**
4. **프로덕션 환경에서의 오버헤드를 고려하라**
5. **자동화된 모니터링 시스템을 구축하라**
