# chapter39 - DOM

DOM(Document Object Model)은 HTML 문서의 계층적 구조와 정보를 표현하며 이를 제어할 수 있는 API, 즉 프로퍼티와 메서드를 제공하는 트리 자료구조다.

## 39.1 노드

### HTML 요소와 노드 객체

HTML 요소는 HTML 문서를 구성하는 개별적인 요소를 의미한다.

```html
<div class="greeting">Hello</div>
```

HTML 요소는 렌더링 엔진에 의해 파싱되어 DOM을 구성하는 요소 노드 객체로 변환된다.

### 노드 객체의 타입

DOM은 노드 객체의 계층적인 구조로 구성된다. 노드 객체는 종류가 있고 상속 구조를 갖는다. 노드 객체는 총 12개의 종류(노드 타입)가 있다. 이 중 중요한 노드 타입은 다음과 같이 4가지다.

**1. 문서 노드(document node)**

- DOM 트리의 최상위에 존재하는 루트 노드로서 document 객체를 가리킨다.
- document 객체는 브라우저가 렌더링한 HTML 문서 전체를 가리키는 객체로서 전역 객체 window의 document 프로퍼티에 바인딩되어 있다.

**2. 요소 노드(element node)**

- HTML 요소를 가리키는 객체다.
- HTML 요소 간의 중첩에 의해 부자 관계를 가지며, 이 부자 관계를 통해 정보를 구조화한다.

**3. 어트리뷰트 노드(attribute node)**

- HTML 요소의 어트리뷰트를 가리키는 객체다.
- 어트리뷰트 노드는 어트리뷰트가 지정된 HTML 요소의 요소 노드와 연결되어 있다.

**4. 텍스트 노드(text node)**

- HTML 요소의 텍스트를 가리키는 객체다.
- 텍스트 노드는 요소 노드의 자식 노드이며, 자식 노드를 가질 수 없는 리프 노드(leaf node)다.

### 노드 객체의 상속 구조

DOM을 구성하는 노드 객체는 ECMAScript 사양에 정의된 표준 빌트인 객체가 아니라 브라우저 환경에서 추가적으로 제공하는 호스트 객체다. 하지만 노드 객체도 자바스크립트 객체이므로 프로토타입에 의한 상속 구조를 갖는다.

모든 노드 객체는 Object, EventTarget, Node 인터페이스를 상속받는다. 추가적으로 요소 노드 객체는 Element 인터페이스를 상속받는다.

## 39.2 요소 노드 취득

### id를 이용한 요소 노드 취득

```javascript
const $elem = document.getElementById("banana");
$elem.style.color = "red";
```

### 태그 이름을 이용한 요소 노드 취득

```javascript
const $elems = document.getElementsByTagName("li");

[...$elems].forEach((elem) => {
  elem.style.color = "red";
});
```

### class를 이용한 요소 노드 취득

```javascript
const $elems = document.getElementsByClassName("fruit");

[...$elems].forEach((elem) => {
  elem.style.color = "red";
});
```

### CSS 선택자를 이용한 요소 노드 취득

```javascript
// 첫 번째 요소 노드만 반환
const $elem = document.querySelector(".banana");

// 모든 요소 노드를 반환
const $elems = document.querySelectorAll("ul > li");
```

### 특정 요소 노드를 취득할 수 있는지 확인

```javascript
const $apple = document.querySelector(".apple");

console.log($apple.matches("#fruits > li.apple")); // true
console.log($apple.matches("#fruits > li.banana")); // false
```

### HTMLCollection과 NodeList

DOM 컬렉션 객체인 HTMLCollection과 NodeList는 DOM API가 여러 개의 결과값을 반환하기 위한 DOM 컬렉션 객체다. 둘 다 유사 배열 객체이면서 이터러블이다.

**HTMLCollection**은 언제나 live 객체로 동작한다. 따라서 HTMLCollection 객체를 사용할 때는 주의해야 한다.

**NodeList**는 대부분의 경우 non-live 객체로 동작하지만 childNodes 프로퍼티가 반환하는 NodeList 객체는 live 객체로 동작한다.

안전하게 DOM 컬렉션을 사용하려면 HTMLCollection이나 NodeList 객체를 배열로 변환하여 사용하는 것을 권장한다.

```javascript
const $elems = document.getElementsByClassName("red");

// 유사 배열 객체인 HTMLCollection을 배열로 변환한다.
[...$elems].forEach((elem) => (elem.className = "blue"));
```

## 39.3 노드 탐색

### 공백 텍스트 노드

HTML 요소 사이의 스페이스, 탭, 줄바꿈 등의 공백 문자는 텍스트 노드를 생성한다. 이를 공백 텍스트 노드라 한다.

### 자식 노드 탐색

| 프로퍼티                            | 설명                                                                              |
| ----------------------------------- | --------------------------------------------------------------------------------- |
| Node.prototype.childNodes           | 자식 노드를 모두 탐색하여 NodeList에 담아 반환한다. 텍스트 노드도 포함될 수 있다. |
| Element.prototype.children          | 자식 노드 중에서 요소 노드만 모두 탐색하여 HTMLCollection에 담아 반환한다.        |
| Node.prototype.firstChild           | 첫 번째 자식 노드를 반환한다. 텍스트 노드이거나 요소 노드다.                      |
| Node.prototype.lastChild            | 마지막 자식 노드를 반환한다. 텍스트 노드이거나 요소 노드다.                       |
| Element.prototype.firstElementChild | 첫 번째 자식 요소 노드를 반환한다.                                                |
| Element.prototype.lastElementChild  | 마지막 자식 요소 노드를 반환한다.                                                 |

### 부모 노드 탐색

```javascript
const $elem = document.getElementById("banana");

console.log($elem.parentNode); // ul#fruits
```

### 형제 노드 탐색

| 프로퍼티                                 | 설명                                                             |
| ---------------------------------------- | ---------------------------------------------------------------- |
| Node.prototype.previousSibling           | 자신의 이전 형제 노드를 반환한다. 텍스트 노드이거나 요소 노드다. |
| Node.prototype.nextSibling               | 자신의 다음 형제 노드를 반환한다. 텍스트 노드이거나 요소 노드다. |
| Element.prototype.previousElementSibling | 자신의 이전 형제 요소 노드를 반환한다.                           |
| Element.prototype.nextElementSibling     | 자신의 다음 형제 요소 노드를 반환한다.                           |

## 39.4 노드 정보 취득

| 프로퍼티                | 설명                                                       |
| ----------------------- | ---------------------------------------------------------- |
| Node.prototype.nodeType | 노드 객체의 종류, 즉 노드 타입을 나타내는 상수를 반환한다. |
| Node.prototype.nodeName | 노드의 이름을 문자열로 반환한다.                           |

## 39.5 요소 노드의 텍스트 조작

### nodeValue

```javascript
const $textNode = document.getElementById("foo").firstChild;

$textNode.nodeValue = "World";

console.log($textNode.nodeValue); // World
```

### textContent

```javascript
const $elem = document.getElementById("foo");

$elem.textContent = "Hi <span>there!</span>";
// Hi <span>there!</span>가 텍스트로 추가된다.
```

## 39.6 DOM 조작

### innerHTML

```javascript
const $fruits = document.getElementById("fruits");

$fruits.innerHTML += '<li class="banana">Banana</li>';
```

innerHTML 프로퍼티는 사용자로부터 입력받은 데이터를 그대로 innerHTML 프로퍼티에 할당하는 것은 **크로스 사이트 스크립팅 공격(XSS)**에 취약하므로 위험하다.

### insertAdjacentHTML 메서드

```javascript
const $elem = document.getElementById("foo");

$elem.insertAdjacentHTML("beforebegin", "<p>beforebegin</p>");
$elem.insertAdjacentHTML("afterbegin", "<p>afterbegin</p>");
$elem.insertAdjacentHTML("beforeend", "<p>beforeend</p>");
$elem.insertAdjacentHTML("afterend", "<p>afterend</p>");
```

### 노드 생성과 추가

```javascript
const $fruits = document.getElementById("fruits");

// 1. 요소 노드 생성
const $li = document.createElement("li");

// 2. 텍스트 노드 생성
const textNode = document.createTextNode("Banana");

// 3. 텍스트 노드를 $li 요소 노드의 자식 노드로 추가
$li.appendChild(textNode);

// 4. $li 요소 노드를 #fruits 요소 노드의 마지막 자식 노드로 추가
$fruits.appendChild($li);
```

### 노드 삽입

```javascript
const $fruits = document.getElementById("fruits");
const $li = document.createElement("li");

$li.appendChild(document.createTextNode("Orange"));

// $fruits 요소 노드의 마지막 자식 요소 앞에 $li 요소 노드를 삽입
$fruits.insertBefore($li, $fruits.lastElementChild);
```

### 노드 이동

```javascript
const $fruits = document.getElementById("fruits");

// $fruits 요소 노드의 마지막 자식 노드를 #fruits 요소 노드의 첫 번째 자식 노드로 이동
$fruits.appendChild($fruits.lastElementChild);
```

### 노드 복사

```javascript
const $fruits = document.getElementById("fruits");
const $apple = $fruits.firstElementChild;

// $apple 요소를 얕은 복사하여 사본을 생성
const $shallowClone = $apple.cloneNode();

// $apple 요소를 깊은 복사하여 모든 자손 노드가 포함된 사본을 생성
const $deepClone = $apple.cloneNode(true);
```

### 노드 교체

```javascript
const $fruits = document.getElementById("fruits");
const $newChild = document.createElement("li");
$newChild.textContent = "Banana";

// #fruits 요소 노드의 첫 번째 자식 요소 노드를 $newChild 요소 노드로 교체
$fruits.replaceChild($newChild, $fruits.firstElementChild);
```

### 노드 삭제

```javascript
const $fruits = document.getElementById("fruits");

// #fruits 요소 노드의 마지막 요소를 DOM에서 삭제
$fruits.removeChild($fruits.lastElementChild);
```

## 39.7 어트리뷰트

### 어트리뷰트 노드와 attributes 프로퍼티

```javascript
const $input = document.getElementById("user");

// attributes 프로퍼티는 NamedNodeMap 객체를 반환한다.
console.log($input.attributes);
// NamedNodeMap {0: type, 1: id, 2: value, length: 3}
```

### HTML 어트리뷰트 조작

```javascript
const $input = document.getElementById("user");

// value 어트리뷰트 값을 취득
const inputValue = $input.getAttribute("value");
console.log(inputValue); // ungmo2

// value 어트리뷰트 값을 변경
$input.setAttribute("value", "foo");
console.log($input.getAttribute("value")); // foo

// value 어트리뷰트의 존재 확인
if ($input.hasAttribute("value")) {
  // value 어트리뷰트 삭제
  $input.removeAttribute("value");
}

console.log($input.hasAttribute("value")); // false
```

### data 어트리뷰트와 dataset 프로퍼티

```html
<!DOCTYPE html>
<html>
  <body>
    <ul class="users">
      <li id="1" data-user-id="7621" data-role="admin">Lee</li>
      <li id="2" data-user-id="9524" data-role="subscriber">Kim</li>
    </ul>
    <script>
      const users = [...document.querySelector(".users").children];

      const user = users.find((user) => user.dataset.userId === "7621");
      console.log(user.dataset.role); // "admin"

      user.dataset.role = "subscriber";
      console.log(user.dataset); // DOMStringMap {userId: "7621", role: "subscriber"}
    </script>
  </body>
</html>
```

## 39.8 스타일

### 인라인 스타일 조작

```javascript
const $div = document.querySelector("div");

// 인라인 스타일 취득
console.log($div.style); // CSSStyleDeclaration { ... }

// 인라인 스타일 변경
$div.style.color = "blue";
$div.style.width = "100px";
$div.style.height = "100px";
$div.style.backgroundColor = "yellow";
```

### 클래스 조작

```javascript
const $box = document.querySelector(".box");

// .box 요소의 class 어트리뷰트 값을 취득
console.log($box.className); // 'box red'

// .box 요소의 class 어트리뷰트 값 중에서 'red'만 'blue'로 변경
$box.className = $box.className.replace("red", "blue");
```

### classList

```javascript
const $box = document.querySelector(".box");

// class 어트리뷰트의 정보를 담은 DOMTokenList 객체를 반환한다.
$box.classList; // DOMTokenList(2) ["box", "red"]

$box.classList.add("foo"); // class="box red foo"
$box.classList.add("bar", "baz"); // class="box red foo bar baz"

$box.classList.remove("foo"); // class="box red bar baz"

$box.classList.replace("red", "blue"); // class="box blue bar baz"

$box.classList.contains("box"); // true
$box.classList.contains("red"); // false

$box.classList.toggle("foo"); // class="box blue bar baz foo"
$box.classList.toggle("foo"); // class="box blue bar baz"
```
