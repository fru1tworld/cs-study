# chapter22 - this

## 22.1 this 키워드

this는 자신이 속한 객체 또는 자신이 생성할 인스턴스를 가리키는 자기 참조 변수다. this를 통해 자신이 속한 객체 또는 자신이 생성할 인스턴스의 프로퍼티나 메서드를 참조할 수 있다.

```javascript
// 객체 리터럴
const circle = {
  radius: 5,
  getDiameter() {
    return 2 * this.radius; // this는 circle을 가리킨다.
  },
};

console.log(circle.getDiameter()); // 10
```

**this 바인딩은 함수 호출 방식에 따라 동적으로 결정된다.**

## 22.2 함수 호출 방식과 this 바인딩

### 일반 함수 호출

```javascript
function foo() {
  console.log("foo's this: ", this); // window
  function bar() {
    console.log("bar's this: ", this); // window
  }
  bar();
}
foo();
```

strict mode에서 일반 함수 내부의 this는 undefined가 바인딩된다.

```javascript
function foo() {
  "use strict";

  console.log("foo's this: ", this); // undefined
  function bar() {
    console.log("bar's this: ", this); // undefined
  }
  bar();
}
foo();
```

### 메서드 호출

```javascript
const person = {
  name: "Lee",
  getName() {
    return this.name; // this는 person을 가리킨다.
  },
};

console.log(person.getName()); // Lee
```

메서드 내부의 this는 메서드를 소유한 객체가 아닌 **메서드를 호출한 객체**에 바인딩된다.

```javascript
const anotherPerson = {
  name: "Kim",
};

// getName 메서드를 anotherPerson 객체의 메서드로 할당
anotherPerson.getName = person.getName;

console.log(anotherPerson.getName()); // Kim

// getName 메서드를 변수에 할당
const getName = person.getName;

// getName 메서드를 일반 함수로 호출
console.log(getName()); // ''
// 일반 함수로 호출된 getName 함수 내부의 this.name은 window.name과 같다.
```

### 생성자 함수 호출

```javascript
function Circle(radius) {
  this.radius = radius;
  this.getDiameter = function () {
    return 2 * this.radius;
  };
}

const circle1 = new Circle(5);
const circle2 = new Circle(10);

console.log(circle1.getDiameter()); // 10
console.log(circle2.getDiameter()); // 20
```

### Function.prototype.apply/call/bind 메서드에 의한 간접 호출

#### apply, call

```javascript
function getThisBinding() {
  return this;
}

const thisArg = { a: 1 };

console.log(getThisBinding()); // window

// apply 메서드는 호출할 함수의 인수를 배열로 묶어 전달한다.
console.log(getThisBinding.apply(thisArg, [1, 2, 3]));
// { a: 1 }

// call 메서드는 호출할 함수의 인수를 쉼표로 구분한 리스트 형식으로 전달한다.
console.log(getThisBinding.call(thisArg, 1, 2, 3));
// { a: 1 }
```

#### bind

```javascript
function getThisBinding() {
  return this;
}

const thisArg = { a: 1 };

// bind 메서드는 함수를 호출하지 않고 this로 사용할 객체만 전달한다.
console.log(getThisBinding.bind(thisArg)); // getThisBinding
// bind 메서드는 함수를 호출하지는 않으므로 명시적으로 호출해야 한다.
console.log(getThisBinding.bind(thisArg)()); // { a: 1 }
```

메서드의 this와 메서드 내부의 중첩 함수 또는 콜백 함수의 this가 불일치하는 문제를 해결하기 위해 유용하게 사용된다.

```javascript
const person = {
  name: "Lee",
  foo(callback) {
    // bind 메서드로 callback 함수 내부의 this 바인딩을 전달
    setTimeout(callback.bind(this), 100);
  },
};

person.foo(function () {
  console.log(`Hi! my name is ${this.name}.`); // Hi! my name is Lee.
});
```

## 22.3 this 바인딩 정리

| 함수 호출 방식                          | this 바인딩                                         |
| --------------------------------------- | --------------------------------------------------- |
| 일반 함수 호출                          | 전역 객체                                           |
| 메서드 호출                             | 메서드를 호출한 객체                                |
| 생성자 함수 호출                        | 생성자 함수가 생성할 인스턴스                       |
| apply/call/bind 메서드에 의한 간접 호출 | apply/call/bind 메서드에 첫 번째 인수로 전달한 객체 |
