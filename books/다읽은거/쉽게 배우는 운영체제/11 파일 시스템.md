# 11. 파일 시스템

## 11.1 파일과 파일 시스템

### 11.1.1 파일 시스템의 개요

#### **파일 시스템의 기능**

파일 시스템의 기능

| 기능                  | 설명                                                                                               |
| --------------------- | -------------------------------------------------------------------------------------------------- |
| 파일 및 디렉터리 구성 | 사용자의 요구에 따라 파일과 디렉터리를 만든다.                                                     |
| 파일 및 디렉터리 관리 | 파일 및 디렉터리의 생성, 수정, 삭제를 관리하며, 사용자가 파일 및 디렉터리에 접근할 수 있도록 한다. |
| 접근 방법 제공        | 파일과 디렉터리에서 읽고 쓰고 실행할 수 있도록 사용자에게 접근 방법을 제공한다.                    |
| 파일 권한 관리        | 다른 사용자에게서 파일 및 디렉터리를 보호하기 위해 접근 권한을 관리한다.                           |
| 무결성 보장           | 파일 내용이 손상되지 않도록 무결성을 보장한다.                                                     |
| 백업과 복구           | 파일을 보호하기 위해 백업과 복구 작업을 한다.                                                      |
| 암호화                | 파일을 암호화하여 악의적인 접근으로부터 파일을 보호한다.                                           |

#### **블록과 파일 테이블**

저장장치는 파일을 일정 크기로 묶어서 관리하는데 이를 블록이라고 한다. 단위는 바이트이지만 저장장치의 단위는 블록이다.

### 11.1.2 파일

#### **파일 종류와 확장자**

**실행 파일**: 운영체제가 메모리로 가져와 CPU를 이용하여 작업하는 파일, 즉 사용자의 요청으로 프로세스가 된 파일이다.
**데이터 파일**: 데이터 파일 실행 파일이 작업하는 데 필요한 데이터를 모아놓은 파일로 이미지 뷰어 프로그램의 사진 파일, 뮤직 플레이어의 음악 파일, 워드 프로세서의 문서 등이 예시

#### **파일 연결 프로그램**

연결 파일은 데이터 파일을 누르면 실행 파일이 실행될 수 있도록 연결해놓은 연결 파일이다.
윈도우에서는 확장자에 따라 연결된 응용 프로그램을 선택할 수 있다.

### 11.1.3 저장장치 관리 기법

#### **파티션**

HDD SSD같은 경우 통쨰로 사용하기도 하짐나 대개 2개나 3개로 나눠서 사용한다 이렇게 나누는 것을 파티셔니라고 하며, 파티션은 디스크를 논리적으로 분할하는 작업이다.

하나의 논리적 저장장치에는 하나의 파일 시스템이 탑재된다.

유닉스는 이러한 문제를 해결하기 위해 여러 개의 파티션을 통합하는 기능을 가지고 있다.
여러개를 하나로 통합한다는 것은 하나의 파일 시스템만 가진다는 것을 의미하고, 이러한 기능을 마운트라고 한다.

#### **포맷**

포맷은 저장장치의 파일 시스템을 초기화하는 작업이다.
파일 테이블이 없는 저장장치를 포맷하면 파일 테이블이 새로 탑재되고 파일 테이블이 있는 저장장치를 포맷하면 파일 테이블이 초가화되어 아무것도 저장되지 않은 처음 상태로 돌아간다.

#### **조각 모음**

HDD의 단편화를 조각모음을 통해서 해결할 수 있다.

### 11.1.4 파일 구조

#### **순차 파일 구조**

파일이 순차적으로 기록되어있는 형태

#### **인덱스 파일 구조**

파일 구조가 인덱스로 되어있다.

#### **직접 파일 구조**

직접 파일 구조는 저장하려는 데이터의 특정 값에 어떤 관계를 정의하여 물리적인 주소로 바로 변환하는 파일 구조다.
해시 함수를 이용하여 주솔르 변환하기 때문에 데이터 접근이 매우 빠르다는 장점이 있다.

## 11.2 디렉터리의 구조

### 11.2.2 디렉터리 파일

사실 디렉터리도 파일이다.

일반 파일과 마찬가지로 헤더가 있다.

### 11.2.3 경로

경로는 파일이 전체 디렉터리 경로 중 어디에 있는지 나타내는 것 절대 경로, 상대 경로로 나뉜다.

### 11.2.4 디렉터리 구조

초기 파일 시스템은 1단계였는데 요즘은 트리 구조로 되어있음
그런데 트리는 순환이 없는 그래프인데 바로가기가 있어서 순환되어있긴함

### 11.2.5 마운트

파티션은 논리적인 디스크 분할
마운트하면 2개의 파티션을 하나의 파일 시스템으로 만들 수 있음

/mnt를 그래서 연결 지점이라고 부른다.

## 11.3 디스크 파일 할당

### 11.3.1 할당 방식

#### **연속 할당과 불연속 할당**

파일 시스템은 기본적으로 메인 메모리 시스템과 유사하다.

일반적으로 파일은 여러 개의 블록을 사용하는데 이러한 여러개의 블록을 연속/ 불연속 할당하여 사용하는 방식으로 구분된다.

#### **연결 할당**

연결리스트 형태로 사용하는 형태

그래서 체인 할당이라고도 한다.

테이블 형태로 관리된다. 예를 들어 윈도우의 FAT가 파티션 전체 블록에 대한 정보를 테이블로 열의 개수로 파티션에 존재하는 블록의 개수를 알 수 있음

#### **인덱스 할당**

연결 리스튼 최대 할당 크기에 제한이 있다.
FAT16는 32GB FAT32는 8TB가 최대 할당
인덱스 할당은 인덱스 블록을 만들어 테이블을 무한히 확장한다.
이러한 방식은 유닉스 운영체제의 아이노드 방식이다.

- **파일 제어 블록**: 파일 소유자와 각종 속성을 나타낸다. 슈퍼 블록이라고도 한ㄷ .
- **블록 포인터**:데이터가 있는 블록의 위치를 직접 연결하는 포인터
- **간접 포인터**: 크기가 작은 파일은 직접 연결된 블록 포인터로 빠르게 접근할 수 있다. 하지만 파일 크기가 커서 블록 포인터가 다 차면 인덱스 블록을 생성한 후 간접 포인터를 생성하여 인덱스 블록을 연결한다.
- **이중/삼중 포인터**: 보통의 경우 인덱스 블록 하나는 256개의 블록을 지정할 수 있다. 파일 크기가 커서 인덳덱스 블록 하나로 안되면 여러개의 인덱스 블록을 연결해서 이중 삼중으로 함

### 11.3.2 빈 공간 관리

내부 단편화를 줄이고 빈 공간을 효율적으로 관리하기 위해 파일 시스템은 빈 블록의 정보만 모아놓는 빈 공간 리스트를 관리한다.

주의해야할 점은 삭제하더라도 지워지지 않고 빈공 간리스트에 삽입된다.

그래서 새로운 데이터를 덮어 쓰지 않는 한 원래 데이터를 복구할 수 있는 여지를 남긴다.

그래서 어떤 데이터를 지우고 새로 넣으면 방금 지워진 블록에 할당하는게 아니라 리스트에 있던 블록 중 맨 앞에 있는 블록에 할당한다.

그래서 디스크 복구나 휴지통에서 삭제한 파일을 되살리는게 가능하다.
