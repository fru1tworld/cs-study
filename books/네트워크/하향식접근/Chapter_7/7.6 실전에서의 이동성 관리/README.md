# 7.6 실전에서의 이동성 관리

<br/>

## 7.6.1 4G/5G 네트워크에서의 이동성 관리

> 오늘날의 4G/5G 네트워크에서의 이동성을 지원하기 위해 어떤 요소들이 어떻게 상호 협력하면서 동작하는지 알아보자.

차량에 탑승한 이동 사용자가 스마트폰으로 4G/5G 방문 네트워크에 접속하여 원격 서버로부터 HD 비디오 스트리밍을 시작한 후,  
**하나의 4G/5G 기지국 셀 영역으로부터 다른 셀 영역으로 이동**하는 시나리오를 생각해보자.

<br/>

<p align="center"><img width="600" alt="이동성 시나리오" src="https://user-images.githubusercontent.com/86337233/216887701-4c7e6f31-d870-4879-8be4-9bb5396a54e3.jpg">

<br/>
<br/>

1. 이동 장치와 기지국 결합
    - 이동 장치는 방문 네트워크의 기지국과 결합한다.


2. 이동 장치에 대한 네트워크 요소의 제어 평면 구성
    - 방문 네트워크 및 홈 네트워크는 이동 장치가 방문 네트워크에 존재함을 나타내는 제어 평면 상태를 설정한다.


3. 이동 장치에 대한 포워딩 터널의 데이터 평면 구성
    - 방문 네트워크와 홈 네트워크는 홈 네트워크의 PDN 게이트웨이를 통한 간접 라우팅을 사용하여,  
      이동 장치와 스트리밍 서버가 IP 데이터그램을 송수신할 수 있는 터널을 설정한다.


4. 한 기지국에서 다른 기지국으로의 이동 장치 핸드오버
    - 이동 장치는 한 기지국에서 다른 기지국으로 핸드오버를 통한 방문 네트워크 결합 지점을 변경한다.

<br/>

### 1️⃣ 기지국 결합

1. 이동 장치는 점차 이러한 기지국에 대한 더 많은 정보를 획득한다.
    - 이동 장치는 해당 지역의 기지국에서 전송되는 기본 신호에 대해 모든 주파수 영역에서 수신한다.


2. 이동 장치는 궁극적으로 **결합**할 기지국을 선택하고, 해당 기지국과 제어 신호 채널을 초기 설정한다.
    - 결합의 일부로서 이동장치는 홈 네트워크 및 다른 가입자 정보, IMSI(고유 식별자)를 기지국에 제공한다.

<br/>

### 2️⃣ 이동 장치에 대한 네트워크 요소의 제어 평면 구성

이동 장치와 기지국 간 신호 채널이 설정되면 기지국은 방문 네트워크의 `MME`와 접촉할 수 있다.

MME는 이동 노드를 대신하여 상태를 설정하기 위해 홈 네트워크 및 방문 네트워크 모두에서 여러 가지 4G/5G 요소들을 참고하고 구성한다.

- MME는 IMSI 및 이동 장치에서 제공한 다른 정보를 사용하여 해당 가입자에 대한 인증, 암호화, 가용한 네트워크 서비스 정보를 검색한다.
    - 해당 정보는 MME의 로컬 캐시에 있거나, 이동 장치가 최근에 접속한 다른 MME에서 검색되거나, 이동 장치의 홈 네트워크에 있는 HSS에서 검색될 수 있다.
- MME는 이동 장치가 현재 방문 네트워크에 존재함을 홈 네트워크에 있는 `HSS`에 알리고, HSS는 데이터베이스를 갱신한다.
- 기지국과 이동 장치는 둘 사이에 설정될 데이터 평면 채널에 대한 매개변수를 선택한다. (제어 평면 시그널링 채널이 이미 작동 중임)

<br/>

### 3️⃣ 이동 장치에 대한 포워딩 터널의 데이터 평면 구성

MME는 아래 그림과 같은 `이동 장치에 대한 데이터 평면`을 구성한다.

<br/>

<p align="center"><img width="600" alt="터널링" src="https://user-images.githubusercontent.com/86337233/216887710-4548ee72-10d6-45bd-8f32-2d6f666a7339.jpg">

<br/>
<br/>

2개의 터널

1. 기지국과 방문 네트워크의 서빙 게이트웨이 사이
2. 해당 서빙 게이트웨이와 **이동 장치의 홈 네트워크**에 있는 PDN 게이트웨이 라우터 사이

→ 4G LTE는 이런 형태의 대칭 간접 라우터를 구현한다.

<br/>

이동 장치에서 들어오고 나가는 모든 트래픽은 장치의 홈 네트워크를 통해 `터널링`된다.

<br/>

4G/5G 터널은 `GPRS 터널링 프로토콜(GPRS Tunneling Protocol, GTP)`를 사용한다.

GTP 헤더의 `TEID(Tunnel Endpoint ID)`는 데이터그램이 속한 터널을 나타내므로, 터널 종단점 간에 GTP에 의해 여러 개의 흐름이 다중화 및 역다중화될 수 있다.

<br/>

### 4️⃣ 한 기지국에서 다른 기지국으로의 이동 장치 핸드오버

`핸드오버(handover)`는 이동 장치가 한 기지국에서 다른 기지국으로 **결합을 변경할 때** 발생한다.

<br/>

- 이동 장치가 송수신하는 데이터그램은 초기에(핸드오버 전에) 연결된 현 기지국(**출발지** 기지국)을 통해 이동장치로 전달된다.
- 핸드오버 이후에는 또 다른 기지국(**목적지** 기지국)을 통해 이동 장치로 라우팅된다.

<br/>

기지국 간의 핸드오버는 이동 장치가 새로운 기지국과 송수신하게 될 뿐만 아니라  
기지국 축면에서 서빙 게이트웨이-기지국 간 터널의 변경을 초래한다.

<br/>

이동 장치는 주기적으로 `현재 기지국의 비컨 신호`와 `들을 수 있는 주변 기지국의 신호 특성`을 측정한다.

측정 결과는 이동 장치의 현 기지국(출발지 기지국)에 초당 한 번 또는 두 번 보고되는데,  
**측정 결과와 주변 셀의 이동 통신 부하 및 기타 요인에 기초하여 현재 기지국은 핸드오버를 시작하도록 요구할 수 있다.**

<br/>

아래 그림은 이동 장치의 출발지 기지국에서 목적지 기지국으로의 핸드오버 절차를 나타낸다.

<br/>

<p align="center"><img width="600" alt="핸드오버" src="https://user-images.githubusercontent.com/86337233/216887712-02ebc640-42fc-4dfa-98ab-172886039029.jpg">

<br/>
<br/>

1. 현 기지국(출발지 기지국)은 목적지 기지국을 선택하고, 목적지 기지국으로 `핸드오버 요청 메시지`를 보낸다.


2. (1) 목적지 기지국은 해당 이동 장치와 그 서비스 품질 요구사항을 지원하기 위한 충분한 자원이 있는지 확인한다.

   (2) 존재한다면 해당 이동 장치를 위한 무선 접속 네트워크의 채널 자원(e.g., 시간 슬롯) 및 기타 자원을 미리 할당한다.

   (3) 목적지 기지국은 출발 기지국에게 `핸드오버 요청 승인 메시지`로 응답하는데, 여기에는 이동 장치가 새로운 기지국과 결합하는 데 필요한 모든 정보가 포함되어 있다.


3. 출발지 기지국은 핸드오버 요청 승인 메시지를 수신하고, `목적지 기지국의 ID 및 채널 접속 정보`를 이동 장치에게 알려준다.
    - 이 시점에서 이동 장치는 새로운 목적지 기지국과 데이터그램을 송수신하기 시작할 수 있다. (즉, 이동 장치의 입장에서는 핸드오버가 완료된 것)
    - 네트워크 입장에서는 해야 할 일이 좀 더 남아 있다.


4. (1) 출발지 기지국은 데이터그램을 이동 장치로 전송하는 것을 중지하고, 대신 수신한 터널링된 데이터그램을 목적지 기지국으로 전달한다.

   (2) 목적지 기지국은 이들 데이터그램을 나중에 이동 장치로 전달한다.


5. (1) 목적지 기지국은 MME에게 자신이 이동 장치를 서비스하는 새로운 기지국이 될 것임을 알린다.

   (2) MME는 다시 서빙 게이트웨이와 목적지 기지국에 차례로 신호를 보내  
   이전 기지국(출발지 기지국)이 아닌 새로운 기지국(목적지 기지국)에서 종료하도록 서빙 게이트웨이-기지국 터널 종단점을 재설정한다.


6. 목적지 기지국은 터널이 재구성되었음을 이전 기지국(출발지 기지국)으로 다시 확인해주어,  
   이전 기지국이 해당 이동 장치와 관련된 자원을 해제할 수 있게 한다.


7. 이 시점에서 목적지 기지국도 이동 장치에 데이터그램 전달을 시작할 수 있다.  
   (핸드오버 기간에 출발지 기지국에서 목적지 기지국으로 전달된 데이터그램을 포함함)

   또한 이동 장치로부터 외부로 나가는 데이터그램을 수신하여 이를 터널을 통해 서빙 게이트웨이로 보낼 수 있다.

<br/>

오늘날의 4G LTE 네트워크의 로밍 구성은 미래의 5G 네트워크에서도 사용될 전망이지만,  
5G 네트워크는 훨씬 더 작은 셀 크기로 조밀해질 것이다.

따라서 많은 실시간 5G 애플리케이션에서 **작은 핸드오버 시간**이 매우 중요해질 것이다.

셀룰러 네트워크 제어 평면을 `SDN 프레임워크`(5장)로 변경한다면 고용량, 저지연의 5G 네트워크 제어 평면을 구현할 수 있을 것으로 믿어진다.

<br/>
<br/>
<br/>

## 7.6.2 이동 IP

오늘날의 인터넷에는 4G/5G 셀룰러 네트워크에서 접했던 것 같은 **‘이동 중인’ 사용자를 위한** 서비스 유형을 제공하는 널리 사용되는 인프라는 없다.

그러나 `이동 IP 구조 및 프로토콜`은 20년 이상 인터넷 RFC로서 표준화되어 왔으며, 새롭고 더 안전하며 일반화된 이동성 지원에 대한 연구가 계속되고 있다.

<br/>

### 4G/5G와 이동 IP 구조의 유사성

<p align="center"><img width="700" alt="4G,5G와 이동 IP 구조의 유사성" src="https://user-images.githubusercontent.com/86337233/216887719-3d46c689-53d4-4479-9ae7-1a2911a603be.png">

<br/>
<br/>

### 이동 IP 표준의 세 가지 주요 부분

> ✅ 에이전트 발견

이동 IP는 `외부 에이전트`가 네트워크에 결합하려는 이동 장치에게 이동성 지원 서비스를 광고하는 데 사용하는 프로토콜을 정의한다.

이러한 서비스에는 이동 장치가 외부 네트워크에서 사용하기 위한 `COA(care-of-address)` 제공,  
이동 장치의 홈 네트워크에 있는 홈 에이전트에 이동 장치 등록, 이동 장치로의 데이터그램 송수신 등과 기타 서비스가 포함된다.

<br/>

> ✅ 홈 에이전트와의 등록

이동 IP는 이동 장치의 홈 에이전트에 COA를 등록 및 취소하기 위해 이동 장치 및 외부 에이전트에서 사용하는 프로토콜을 정의한다.

<br/>

> ✅ 데이터그램의 간접 라우팅

이동 IP는 데이터그램이 홈 에이전트에 의해 이동 장치로 전달되는 방식을 정의한다.

여기에는 데이터그램을 전달하고 오류를 처리하기 위한 규칙과 여러 형태의 터널링이 포함된다.
