# 8 가상 메모리의 기초

컴퓨터마다 물리 메모리, 즉 실제 메모리의 크기가 다르다. 가상 메모리는 크기가 다른 물리 메모리에서 일관되게 프로세스를 실행할 수 있는 기술이다.

## 8.1 가상 메모리의 개요

### 8.1.1 가상 메모리 시스템

가상 메모리 시스템에서 모든 프로세스는 메모리의 어느 위치에 있는지 상관없이 0번부터 시작하는 연속된 메모리 공간을 가진다.

7 장에서 소개한 논리 주소의 크기는 물리 메모리의 주소 공간에 비례하지만, 가상 주소는 물리 메모리 공간이 아닌 가상의 주소 공간을 가진다.

이론적으로 가상 메모리의 크기는 무한하지만 실제로 최대 크기는 컴퓨터 시스템이 가진 물리 메모리의 최대 크기로 한정되며, CPU의 비트에 따라 결정됩니다.

가상 메모리에서 메모리 관리자가 사용할 수 있는 메모리의 전체 크기는 물리 메모리와 스왑 영역의 합한 크기다.

가상 메모리 시스템에서 메모리 관리자는 물리 메모리와 스왑 영역을 합쳐서 프로세스가 사용하는 가상 주소를 실제 메모리의 물리 주소로 변환 한다.

이러한 변환을 동적 주소 변환이라고 한다.

동적 주소 변환을 거치면 프로세스가 아무 제약 없이 사용자 데이터를 물리 메모리에 배치할 수 있다.

이 과정에서 메모리 관리자는 물리 메모리를 어떤 방법으로 나눌지, 사용자 프로세스를 어디에 배치할지, 부족한 물리 메모리를 어떻게 처리할지 등의 복잡한 문제를 처리한다.

### 8.1.2 매핑 테이블의 필요성과 역할

메모리는 매핑 테이블을 작성하여 관리한다.

가상 메모리 시스템에서 가상 주소는 실제로 물리 주소나 스왑 영역 중 한 곳에 위치한다.

메모리 관리자는 가상 주소와 물리 주소를 일대일로 매핑한 테이블로 관리한다.

가상 주소가 물리 메모리의 어느 위치에 있는지 나타낸다.

메모리 분할 방식은 가변 분할 방식과 고정 분할 방식으로 나뉜다고 했는데

가상 메모리 시스템도 마찬가지다.

가상 메모리 시스템에서 가변 분할 방식을 이용한 기법은 세그먼테이션, 고정 분할 방식을 이용한 메모리 관리 기법은 페이징이라고 한다.

그래서 페이지 매핑 테이블, 세그먼테이션 매핑 테이블이라 한다.

### 8.1.3 지역성

지역성 이론이 있다.
접근하는 패턴이 고루 분포되는 것이 아니라 특정 영역에 집중되는 성질을 말한다.

- **공간의 지역성**: 가까운 데이터에 접근할 확률이 먼 거리에 있는 데이터에 접근할 확률보다 높음을 의미한다.
- **시간의 지역성**: 현재 시간 기준으로 가까운 시간에 접근한 데이터가 먼 시간에 접근한 데이터보다 사용될 확률이 높음을 의미한다.
- **순차적 지역성**: 일반적인 프로그래밍은 앞에서부터 순차적으로 진행된다. 순차적 지역성은 작업이 순서대로 진행되는 것을 의미한다.

## 8.2 페이징 기법

### 8.2.1 페이징 기법의 구현

페이징 기법은 고정 분할 방식을 이용한 가상 메모리 관리 기법으로, 물리 주소 공간을 같은 크기로 나누어 사용한다.

왼쪽의 가상 주소는 프로세스 입장에서 바라본 메모리 공간으로 항상 0번부터 시작한다.

가상 주소의 분할된 각 영역을 페이지라고 부르며 첫 번째 영역은 페이지 0, 두 번째 영역은 페이지 1과 같이 번호를 매겨 관리한다.

물리 메모리의 각 영역은 가상 주소의 페이지와 구분하기 위해 프레임이라고 부른다.

프레임도 페이지과 마찬가지로 번호를 매겨 관리한다.

페이지와 프레임의 크기는 같다.

크기가 같기 때문에 페이지는 어떤 프레임에도 배치될 수 있다.

페이지 테이블은 하나의 열로 구성된다.

페이지의 정보를 순서대로 가지고 있으므로 0부터 인덱싱되어있다.

물리 메모리가 없으면 테이블에 invalid라고 표시하는데 스오바 영역에 있다는 의미다.

### 8.2.2 페이징 기법의 주소 변환

#### **주소 변환 과정**

예를 들어 프로세스가 30번의 내용을 읽으려고 할 때 줏 변환 과정은 다음과 같다.

1. 가상 주소 30번이 어느 페이지에 있는지 찾는다. 30번은 페이지 3의 0번 위치에 있다.
2. 페이지 테이블의 페이지 3으로 가서 해당 페이지가 프레임1에 있다는 것을 알아낸다.
3. 최종적으로 물리 메모리 프레임 1의 0번 위치에 접근한다. 이 주소가 가상 주소 30번의 물리 주소다.

#### **정형화된 주소 변환**

주소 변환 과정을 정형화해보자 페이징 기법에서는 가상 주소를 VA<P,D>로 표현한다.

VA는 가상 주소 P는 페이지 D는 페이지의 처음 위치에서 해당 주소까지의 거리를 의미한다.

페이징 기법의 주소 변환은 가상 주소 VA<P,D>를 물리 주소 PA<F,D>로 변환하는 것이다.

PA는 물리주소의 주소를 가리키는 용어로 물리 주소 혹은 실제 주소라고 한다.

PA<F,D>에서 F는 프레임, D는 프레임의 처음 위치에서 해당 주소까지의 거리

페이지 테이블을 이용하면 간단하게 가상 주소를 물리 주소로 변환할 수 있다.

페이지 테이블에서 페이지 번호를 찾아 해당 프레임 번호를 쫓아가면 된다.

페이지 테이블은 페이지 번호와 프레임 번호로 구성되며, 각각의 한 줄을 페이지 테이블 엔트리라고 부른다.

페이지 테이블은 페이지 번호와 프레임 번호로 구성된 페이지 테이블 엔트리의 집합이다.

페이징 기법에서 페이지 테이블 엔트리는 프레임 번호만 가진다.

페이지 테이블에 페이지 번호가 0부터 순서대로 정리되어 있기 때문에 굳이 페이지 번호를 표시할 필요가 없다.

페이지 테이블 엔트리에 페이지 번호와 프레임 번호가 함께 표시되어 있다면 페이지 번호가 순서대로 저장되지 않은 경우다.

#### **16bit CPU의 주소 변환 예**

한 페이지를 10B로 나누면 주소 변환 과정은 그리 어렵지 않다.

에를 들면 가상 주소 30번은 VA=<3,0>로 나눌 수 있다.

그러나 컴퓨터는 2진법을 사용하므로 페이지의 크기는 2^N 승이 된다.

그래서 페이지의의 크기가 다양할 경우 다음과 같은 공식을 사용한다.

P=나눗셈(가상 주소/ 한 페이지의 크기)의 몫

D=나눗셈(가상 주소/ 한 페이지의 크기)의 나머지

### 8.2.3 페이징 테이블 관리

#### **메모리 공유**

시스템에 여러 개의 프로세스가 존재하고 프로세스마다 페이지 테이블이 하나씩 있기 때문에 페이지 테이블 관리가 복잡하다.

프로세스 A,B,C가 하나의 물리 메모리를 사용하는 경우. 프로세스는 메모리에 올라와야 실행이 가능하므로 모든 프로세스의 일부 페이지가 물리 메모리의 프레임에 올라와 있고, 어떤 페이지가 어떤 프레임에 있는지 관리하기 위해
프로세스마다 페이지 테이블을 운영중이다.

페이지 테이블은 메모리 관리자가 자주 사용하는 자료구조이므로 필요시 빨리 접근할 수 있어야한다

따라서 페이지 테이블은 물리 메모리 영역 중 운영체제 영역의 일부분에 모아놓는다.

시스템 내에는 여러 개의 프로세스가 존재하고 프로세스마다 하나의 페이지 테이블이 있기 때문에 전체 페이지 테이블의 크기는 프로세스의 수에 비례해서 커진다.

한 번에 실행하는 프로세스의 수가 많으면 페이지 테이블의 크기가 같이 커지고, 그에 따라 프로세스가 실제로 사용할 수 있는 메모리 영역이 줄어진다.

#### **a**

#### **a**

#### **a**

#### **a**

## 8.3 세그먼테이션 기법

### 8.3.1 세그먼테이션 기법의 구현

### 8.3.2 세그먼테이션 기법의 주소 변환

## 8.4 캐시 매핑 기법

### 8.4.1 캐시 직접 매핑

### 8.4.2 캐시 연관 매핑

### 8.4.3 캐시 집합-연관 매핑
