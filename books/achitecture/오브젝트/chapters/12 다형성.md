# 12 다형성

## 다형성이란?

**다형성(Polymorphism)**: 많은 형태를 가질 수 있는 능력

### 객체지향의 다형성
- 하나의 추상 인터페이스에 대해 여러 구체적인 구현을 가질 수 있음
- 동일한 메시지에 대해 다르게 반응할 수 있음
- 서로 다른 타입의 객체를 동일한 타입으로 취급할 수 있음

## 다형성의 종류

### 1. 오버로딩 다형성 (Ad Hoc Polymorphism)
- 메서드 오버로딩
- 같은 이름, 다른 시그니처
- 컴파일 시점에 결정

### 2. 강제 다형성 (Coercion Polymorphism)
- 타입 변환
- 묵시적 형 변환

### 3. 매개변수 다형성 (Parametric Polymorphism)
- 제네릭 프로그래밍
- 타입을 파라미터로

### 4. 포함 다형성 (Inclusion Polymorphism)
- 서브타입 다형성
- 상속을 이용한 다형성
- **객체지향의 핵심**

## 바인딩

### 정적 바인딩 (Static Binding)
- 컴파일 시점에 호출할 메서드 결정
- 메서드 오버로딩
- 빠른 성능

### 동적 바인딩 (Dynamic Binding)
- 실행 시점에 호출할 메서드 결정
- 메서드 오버라이딩
- 유연한 설계

## 업캐스팅과 동적 바인딩

### 업캐스팅
```java
Movie movie = new AmountDiscountMovie(...);
```
- 부모 타입으로 자식 객체 참조
- 다형성의 기반

### 동적 메서드 탐색
1. 메시지를 수신한 객체의 클래스에서 메서드 탐색
2. 없으면 부모 클래스에서 탐색
3. 최상위 클래스까지 반복

### self 참조 (this)
- 메시지를 수신한 객체를 가리킴
- 동적 바인딩의 핵심
- 실제 객체의 타입에 따라 달라짐

## 상속과 다형성

### 상속의 두 가지 용도
1. **타입 계층 구축**: 다형성 제공
2. **코드 재사용**: 중복 제거

### 상속이 제공하는 것
- 타입 계층
- 다형적인 협력
- 유연한 설계

### 상속의 문제
- 구현 상속 시 결합도 증가
- 인터페이스 상속을 사용해야 함

## 추상화와 다형성

### 추상화의 힘
- 구체적인 내용을 숨김
- 중요한 것에 집중
- 유연한 설계의 기반

### 추상 클래스와 인터페이스
```java
public interface DiscountPolicy {
    Money calculateDiscountAmount(Screening screening);
}
```

### 프로그래밍 대상의 추상화
- 도메인의 복잡성을 단순화
- 구체 클래스가 아닌 추상화에 의존
- 변경에 유연한 설계

## 리스코프 치환 원칙 (LSP)

**서브타입은 그것의 기반 타입에 대해 대체 가능해야 한다**

### 원칙
- 자식 클래스는 부모 클래스를 대체할 수 있어야 함
- 클라이언트는 차이를 인식하지 못해야 함
- 행동 호환성이 중요

### 위반 사례
- 예외를 던지는 오버라이드 메서드
- 사전조건을 강화하는 서브타입
- 사후조건을 약화하는 서브타입

### 준수 방법
- 계약에 의한 설계 (Design by Contract)
- 사전조건을 약화시키지 않음
- 사후조건을 강화시키지 않음
- 불변식을 유지

## 계약에 의한 설계

### 사전조건 (Precondition)
- 메서드가 호출되기 전에 만족해야 할 조건
- 클라이언트의 의무

### 사후조건 (Postcondition)
- 메서드가 실행된 후 만족해야 할 조건
- 서버의 의무

### 불변식 (Invariant)
- 항상 유지되어야 하는 조건
- 메서드 실행 전후에 동일

## 변경으로부터 보호

### 다형성의 힘
- 새로운 타입 추가 시 기존 코드 변경 불필요
- 개방-폐쇄 원칙 (OCP) 지원
- 확장에는 열려 있고 수정에는 닫혀 있음

### 추상화의 역할
- 변경을 캡슐화
- 구체적인 내용을 숨김
- 변경의 영향을 최소화

## 다형성 활용

### TEMPLATE METHOD 패턴
- 알고리즘의 구조를 정의
- 일부 단계를 서브클래스로 연기
- 상속을 통한 다형성

### STRATEGY 패턴
- 알고리즘을 캡슐화
- 실행 중에 알고리즘 교체
- 합성을 통한 다형성

## 교훈

1. **다형성은 객체지향의 핵심이다**
2. **추상화에 의존하라**
3. **동적 바인딩을 이해하라**
4. **리스코프 치환 원칙을 준수하라**
5. **상속은 is-a 관계일 때만 사용하라**
6. **다형성을 이용해 변경을 관리하라**
7. **구현이 아닌 인터페이스에 프로그래밍하라**
