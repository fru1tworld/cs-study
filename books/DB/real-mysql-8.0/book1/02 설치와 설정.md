# 02 설치와 설정

## MySQL 설치 방법

### 1. 운영체제별 설치

#### Linux (Ubuntu/Debian)

```bash
# APT 저장소 추가
wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb
sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb

# MySQL 설치
sudo apt-get update
sudo apt-get install mysql-server

# 서비스 시작
sudo systemctl start mysql
sudo systemctl enable mysql
```

#### Linux (CentOS/RHEL)

```bash
# YUM 저장소 추가
sudo yum install https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm

# MySQL 설치
sudo yum install mysql-server

# 서비스 시작
sudo systemctl start mysqld
sudo systemctl enable mysqld
```

#### macOS

```bash
# Homebrew 사용
brew install mysql

# 서비스 시작
brew services start mysql
```

#### Windows

- MySQL Installer for Windows 다운로드
- GUI 인스톨러로 설치
- MySQL Server, MySQL Workbench 등 선택 설치

### 2. Docker를 이용한 설치

```bash
# MySQL 8.0 컨테이너 실행
docker run --name mysql8 \
  -e MYSQL_ROOT_PASSWORD=password \
  -p 3306:3306 \
  -d mysql:8.0

# 컨테이너 접속
docker exec -it mysql8 mysql -uroot -p
```

## 초기 보안 설정

### mysql_secure_installation

```bash
# 보안 설정 스크립트 실행
sudo mysql_secure_installation
```

설정 항목:

1. **비밀번호 정책 설정**: VALIDATE PASSWORD 플러그인
2. **root 비밀번호 변경**: 강력한 비밀번호 설정
3. **익명 사용자 제거**: 보안을 위해 제거 권장
4. **원격 root 로그인 비활성화**: 보안상 권장
5. **test 데이터베이스 제거**: 불필요한 데이터베이스 제거

## MySQL 디렉터리 구조

### 주요 디렉터리

#### 데이터 디렉터리 (datadir)

```
기본 위치:
- Linux: /var/lib/mysql
- macOS: /usr/local/mysql/data
- Windows: C:\ProgramData\MySQL\MySQL Server 8.0\Data
```

포함 내용:

- 데이터베이스별 디렉터리
- 시스템 테이블
- 로그 파일
- InnoDB 데이터 파일

#### 설정 파일

```
위치:
- Linux: /etc/my.cnf, /etc/mysql/my.cnf
- macOS: /etc/my.cnf
- Windows: C:\ProgramData\MySQL\MySQL Server 8.0\my.ini
```

#### 로그 파일

- 에러 로그: hostname.err
- 일반 쿼리 로그: hostname.log
- 슬로우 쿼리 로그: hostname-slow.log
- 바이너리 로그: binlog.\*

## 설정 파일 (my.cnf/my.ini)

### 기본 구조

```ini
[mysqld]
# 서버 설정

[mysql]
# 클라이언트 설정

[client]
# 모든 클라이언트 공통 설정
```

### 주요 설정 항목

#### 기본 설정

```ini
[mysqld]
# 서버 식별
server-id = 1
port = 3306
socket = /tmp/mysql.sock

# 데이터 디렉터리
datadir = /var/lib/mysql

# 문자셋
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 인증 플러그인
default-authentication-plugin = caching_sha2_password
```

#### 성능 관련 설정

```ini
# InnoDB 버퍼 풀 (물리 메모리의 70-80%)
innodb_buffer_pool_size = 8G

# InnoDB 버퍼 풀 인스턴스 수
innodb_buffer_pool_instances = 8

# 최대 연결 수
max_connections = 500

# 쿼리 캐시 (8.0에서는 제거됨)
# query_cache_type = 0

# 임시 테이블 크기
tmp_table_size = 64M
max_heap_table_size = 64M

# 정렬 버퍼
sort_buffer_size = 2M
join_buffer_size = 2M

# 스레드 캐시
thread_cache_size = 50
```

#### 로그 설정

```ini
# 에러 로그
log-error = /var/log/mysql/error.log

# 일반 쿼리 로그 (개발 환경에서만)
general_log = 0
general_log_file = /var/log/mysql/general.log

# 슬로우 쿼리 로그
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# 바이너리 로그
log-bin = /var/log/mysql/binlog
binlog_format = ROW
binlog_expire_logs_seconds = 604800  # 7일
max_binlog_size = 100M
```

#### InnoDB 설정

```ini
# InnoDB 파일 포맷
innodb_file_per_table = 1

# InnoDB 로그 파일
innodb_log_file_size = 512M
innodb_log_files_in_group = 2
innodb_log_buffer_size = 16M

# InnoDB 플러시 방법
innodb_flush_log_at_trx_commit = 1
innodb_flush_method = O_DIRECT

# InnoDB I/O 설정
innodb_io_capacity = 200
innodb_io_capacity_max = 2000
innodb_read_io_threads = 4
innodb_write_io_threads = 4
```

#### 복제 설정

```ini
# 서버 ID (복제 환경에서 고유해야 함)
server-id = 1

# 바이너리 로그
log-bin = mysql-bin
binlog_format = ROW

# GTID 사용
gtid_mode = ON
enforce_gtid_consistency = ON

# 복제 설정
read_only = 0  # 마스터에서는 0, 슬레이브에서는 1
super_read_only = 0

# 슬레이브 설정
relay-log = relay-bin
relay-log-index = relay-bin.index
```

## 서버 시작과 종료

### systemd 사용 (Linux)

```bash
# 시작
sudo systemctl start mysql

# 종료
sudo systemctl stop mysql

# 재시작
sudo systemctl restart mysql

# 상태 확인
sudo systemctl status mysql

# 부팅 시 자동 시작
sudo systemctl enable mysql
```

### 직접 실행

```bash
# 시작
mysqld --defaults-file=/etc/my.cnf &

# 안전 모드로 시작
mysqld_safe --defaults-file=/etc/my.cnf &

# 종료
mysqladmin -u root -p shutdown
```

## 접속 및 기본 명령

### MySQL 접속

```bash
# 로컬 접속
mysql -u root -p

# 원격 접속
mysql -h hostname -u username -p

# 데이터베이스 지정
mysql -u root -p database_name

# 포트 지정
mysql -h hostname -P 3306 -u username -p
```

### 기본 관리 명령

```sql
-- 버전 확인
SELECT VERSION();

-- 현재 사용자 확인
SELECT USER(), CURRENT_USER();

-- 데이터베이스 목록
SHOW DATABASES;

-- 현재 설정 확인
SHOW VARIABLES;
SHOW VARIABLES LIKE 'innodb%';

-- 프로세스 목록
SHOW PROCESSLIST;

-- 상태 확인
SHOW STATUS;

-- 엔진 목록
SHOW ENGINES;
```

## 사용자 및 권한 관리

### 사용자 생성

```sql
-- 사용자 생성
CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';

-- 원격 접속 허용
CREATE USER 'username'@'%' IDENTIFIED BY 'password';
```

### 권한 부여

```sql
-- 모든 권한 부여
GRANT ALL PRIVILEGES ON database_name.* TO 'username'@'localhost';

-- 특정 권한 부여
GRANT SELECT, INSERT, UPDATE, DELETE ON database_name.*
TO 'username'@'localhost';

-- 권한 적용
FLUSH PRIVILEGES;
```

### 권한 확인 및 제거

```sql
-- 권한 확인
SHOW GRANTS FOR 'username'@'localhost';

-- 권한 제거
REVOKE ALL PRIVILEGES ON database_name.* FROM 'username'@'localhost';

-- 사용자 삭제
DROP USER 'username'@'localhost';
```

## 성능 모니터링

### Performance Schema

```sql
-- Performance Schema 활성화 (my.cnf)
[mysqld]
performance_schema = ON

-- 모니터링 정보 조회
SELECT * FROM performance_schema.events_statements_summary_by_digest
ORDER BY SUM_TIMER_WAIT DESC
LIMIT 10;
```

### sys Schema

```sql
-- 슬로우 쿼리 확인
SELECT * FROM sys.statements_with_runtimes_in_95th_percentile;

-- 테이블 스캔 확인
SELECT * FROM sys.statements_with_full_table_scans;

-- InnoDB 버퍼 풀 사용률
SELECT * FROM sys.innodb_buffer_stats_by_table;
```

## 백업 및 복구

### 논리적 백업 (mysqldump)

```bash
# 전체 백업
mysqldump -u root -p --all-databases > all_databases.sql

# 특정 데이터베이스
mysqldump -u root -p database_name > database_name.sql

# 특정 테이블
mysqldump -u root -p database_name table_name > table_name.sql

# 복구
mysql -u root -p database_name < backup.sql
```

### 물리적 백업

```bash
# 데이터 디렉터리 복사 (서버 종료 필요)
sudo systemctl stop mysql
sudo cp -r /var/lib/mysql /backup/mysql
sudo systemctl start mysql
```

## 문제 해결

### 접속 문제

```sql
-- root 비밀번호 분실 시
# 1. 안전 모드로 시작
mysqld_safe --skip-grant-tables &

# 2. 비밀번호 변경
mysql -u root
ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';
FLUSH PRIVILEGES;
```

### 로그 확인

```bash
# 에러 로그 확인
tail -f /var/log/mysql/error.log

# 슬로우 쿼리 로그 확인
tail -f /var/log/mysql/slow.log
```

## 결론

MySQL 8.0의 설치와 설정은 운영 환경에 맞게 최적화되어야 한다. 적절한 설정과 모니터링을 통해 안정적이고 효율적인 데이터베이스 환경을 구축할 수 있다.
