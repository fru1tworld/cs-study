## 4.1 예제

### 4.1.1 프로듀서 설명

**멱등성 프로듀서**

여러 번 보내더라도 메시지가 한 번만 생산되는 방식을 나타낸다.

멱등성 프로듀서를 사용하려면 enable.idempotence=true 구성 속성을 설정할 수 있다.

## 4.2 프로듀서 옵션

중요한 프로듀서 옵션

| 키                | 용도                                                           |
| ----------------- | -------------------------------------------------------------- |
| acks              | 메시지 전달이 성공하기 위한 프로듀서가 요구하는 복제 확인의 수 |
| bootstrap.servers | 시작 시 연결 할 하나 이상의 카프카 브로커                      |
| value.serializer  | 값의 직렬화에 사용되는 클래스                                  |
| key.serializer    | 키의 직렬화에 사용되는 클래스                                  |

### 4.2.1 브로커 목록 구성

카프카에 메시지를 작성하는 예제에서 메시지를 보낼 토픽을 프로듀서에게 알려야 한다는 사실은 분명하다.

토픽은 파티션으로 구성되어 있는데, 카프카는 토픽과 파티션이 있는 위치를 어떻게 알수 있을까 ?

프로듀서에게 필요한 구성 옵션 중 하나는 bootstrap.servers이다.
bootstrap.servers 속성은 초기 브로커를 여러 개 또는 하나만 사용한다.

이 브로커에 연결하여 클라이언트는 클러스터에 있는 다른 브로커에 대한 데이터도 포함하는 필요한 메타데이터를 발견할 수 있다.

### 4.2.2 더 빨리(또는 안전하게) 처리하기

acks를 0으로 설정하면 빠르지만 데이터가 유실될 수 있다.

akcs를 all 또는 -1로 설정하면 구성 설정에서 사용할 수 있는 배달 보장에 있어서 가장 강력한 옵션이다.

all 값은 파티션 리더의 레플리카가 ISR(In-Sync-Replica)의 전체 목록에 대해 복제 완료를 확인하기를 기다린다는 의미임을 보여준다.

즉 프로듀서는 파티션에 대한 모든 레플리카가 성공하기 전까지는 성공 확인을 받지 못한다.

acks 값을 1로 설정하고 수신 확인을 요청할 때의 영향은 다음과 같다.

메시지 수신자가 확인을 프로듀서에게 다시 보내는 과정이 포함된다.

프로듀서 클라이언트는 이 수신 확인을 기다린다.

그러나 실패로 인해 리더가 다운되기 전에 팔로워가 메시지를 복사하지 않았을 수도 있다.

> acks 설정은 성능뿐만 아니라 메시지 전달 안정성까지 책임지는 카프카라는 큰 그림의 핵심 기능 중 하나다.

### 4.2.3 타임스탬프

최신 버전의 프로듀서 레코드에는 전달하는 이벤트에 대한 타임스탬프가 포함되어 있다.

ProducerRecord 자바 객체를 프로듀서에게 전달할 때 자바 long 데이터 유형으로 사용자가 직접전달하거나 현재 시스템 시간으로 전달할 수 있다.

- CreateTime으로 설정하면 클라이언트에서 설정한 시간이 사용되는 반면
- LongAppendTime으로 설정하면 브로커 시간이 사용된다.

일반적으로 트랜잭션이 브로커에게 전달된 시간이 아니라 발생하는 시간이라면 생성 시간이 필요할 수 있지만 생성된 시간이 메시지 자체 내에서 처리되거나 실제 이벤트 시간이 비즈니스 또는 주문과 관련이 없는 경우 브로커 시간이 유용할 수 있다.

## 4.3 요구사항에 대한 코드 생성

### 4.3.1 클라이언트와 브로커 버전
