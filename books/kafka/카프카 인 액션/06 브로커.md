# 6 브로커

브로커는 다른 브로커와 협력해서 더 큰 시스템을 구성하는데 사용한다.

## 6.4 파티션 리더 레플리카와 그 역할

ISR는 카프카를 이해하기 위한 핵심 부분이다.

새 토픽의 경우 특정 수의 레플리카가 생성되어 초기 ISR 목록에 추가된다.

이 번호는 매개변수 또는 기본적으로 브로커 구성에서 가져올 수 있다.

카프카에서 주목해야 할 세부 사항 중 하나는 레플리카가 기본적으로 자체 복구되지 않는다는 것이다.

파티션 사본 중 하나ㅏ 존재하는 브로커를 잃어버리면 카프카는 새 사본을 생성하지 않는다.

우리 시스템의 상태를 모니터링할 때 살펴봐야 할 중요한 항목은 얼마나 많은 ISR이 실제로 우리가 원하는 수와 일치하는지다.

### 6.4.1 데이터 손실

ISR이 없고 장애로 인해 리더 레플리카가 손실되면 어떻게 될까 ?

unclean.leader.election.enable 값이 true이면 컨트롤러는 레플리카가 최신이 아니더라도 시스템이 계속 실행되도록 파티션의 리더를 선택한다.

이 방식의 문제점은 리더가 실패했을 때 살아 있는 레플리카 중 어느 것도 모든 데이터를 갖고 있지 않기 때문에 데이터가 손실될 수 있다는 것이다.

## 6.5 카프카 엿보기

모니터링 도구는 Grafana와 Prometheue가 좋다.

Kafka는 런타임에 수평확장할 수 있다는 장점이 존재한다.
