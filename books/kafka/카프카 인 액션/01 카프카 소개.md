# 1. 카프카 소개

## 1.1 카프카의 특징

- 메시지 큐처럼 레코드를 읽고 쓴다.
- 내결함성으로 레코드를 저장한다.
- 스트림이 발생할 때 처리한다.

카프카는 다음 세 가지 배달 방식도 제공한다.

- **최소 한 번 시맨틱**: 메시지는 수신확인이 될 때까지 재발송한다.
- **최대 한 번 시맨틱**: 메시지는 단 한 번 보내며 실패하더라도 재발송하지 않는다.
- **정확히 한 번 시맨틱**: 메시지는 이 메시지의 컨슈머에게 단 한번만 보인다.

최소 한 번 시맨틱의 경우 프로듀서가 같은 메시지를 한 번 이상 보내어 브로커에 틀림없이 기록되도록 카프카를 구성할 수 있다.

비록 중복으로 인해 컨슈머 단에서 필터링 해야 할 수는 있겠지만 가장 안전한 배달 방식

최대 한 번 시맨틱의 경우 프로듀서가 메시지를 한 번 보내면 절대 재시도하지 않는 경우이다.

수신 확인을 기다리지 않는 것이 데이터 유실 비용보다 더 가치가 높을 수 있다.

카프카는 0.11.0 버전에서 EOS(Exactly Once Semantics)라고 알려진 정확히 한 번 시맨틱을 추가헀다.

많은 사용 사례에서 정확히 한 번 시맨틱이 이상적이다.

EOS의 출시에 따른 또 다른 논의는 정확히 한 번이 가능한지에 대한 논의였다.

이는 컴퓨터과학 이론으로 깊게 들어가지만, 카프카가 EOS 기능을 어떻게 정의하는지 알고 있따면 도움이 된다.

프로듀서가 메시지를 한 번 이상 보내더라도 최종 컨슈머는 여전히 단 한 번만 받을 것이다.

EOS는 전체 카프카 계층에서 접점을 지니고 있는데 이에 대해서는 이 책 후반부에서 간략하게 다룰 것이며, 지금은 설명을 진행한다.

## 1.2 카프카사용

카프카는 기본적으로 복제와 내결함성을 특징으로 하는 고성능, 메시지 배달 도구로 유명하다.

### 1.2.1 개발자를 위한 카프카

카프카가 카프카 자신의 기능을 사용하고 있다는 점도 카프카의 신뢰성을 더할 수 있는 또 다른 흥미로운 주제이다.

### 1.2.2 매니저에게 카프카 설명하기

카프카의 특징은 대량의 데이터를 가져와소 다양한 사업부에서 사용 가능하게 하는 능력이다.

카프카는 데이터가 가치로 빠르게 전환되는 속도를 제한하는 일일 배치 작업에서 벗어나는 한 가지 방법이다.

## 1.3 카프카에 관한 오해

### 1.3.2 카프카는 다른 메시지 브로커와 동일하다.

- 기본적으로 메시지를 리플레이하는 능력
- 데이터 병렬 처리

카프카는 다수의 컨슈머를 갖도록 설계됐다.

이는 메시지 브로커로부터 하나의 애플리케이션이 어떤 메시지를 읽고 있을 때 같은 메시지를 소비하려는 다른 애플리케이션에서도 이 메시지가 제외되지 않는다는 사실을 의미한다.

## 1.4 현실 세계에서의 카프카

### 1.4.3 카프카가 적합하지 않을 수 있는 경우

카프카는 항상 최선이 아닐 수 있다. 만약 대규모 배치 처리 작업이라면 어떻게 할까 ?

메시지가 정렬되지 않는 상황을 방지하려면 최대 1개의 프로듀서 요청 스레드와 함께 토픽의 티션이 1개만 있는지도 확인해야 한다.

엄격한 순서에 의존하는 방대한 데이터가 있는 경우 메시지 소비는 한 번에 그룹당 1개의 컨슈머로 제한된다는 사실로 인한 잠재적인 문제가 발생할 수 있다.

카프카는 선형 읽기와 쓰기에서 돋보이지만 카프카에 있어 큰 메시지가 흥미로운 도전과제이다.
