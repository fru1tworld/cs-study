# 2. 관측 가능성 기반 기술

## 2.1 트래픽 관리

### 2.1.1 단일 장애점

쿠버네티스의 네트워크 구성은 복잡하다. DNS(쿠브 DNS), 프록시(쿠브 프록시), 게이트웨이(인그레스)를 내부적으로 관리하며, 각 구성요소에 문제가 발생하면 전체 클러스터의 장애로 전파된다.

네트워크는 SPOF의 특징을 갖고 있어, 네트워크 장애가 생기면 기업과 고객에게 많은 손해를 끼친다.

분산 마이크로서비스와 동적인 클라우드 환경에서는 관측 가능성만으로는 장애를 극복하기에 충분하지 않으므로 관측 가능성뿐만 아니라 네트워크 트래픽 데이터를 수집하고 관리하여 IT 운영에 대한 이해도를 높여야한다.

### 2.1.2 로드 밸런서

여러 개의 DNS 서버와 여러 유형의 로드 밸런서를 구성하는 것이 일반적이다.

쿠버네티스는 자체적인 로드 밸런서(쿠브 프록시)와 DNS 서버를 가지고 있으며, 이를 정확히 이해하지 않으면 네트워크 장애 발생 시 문제 해결이 쉽지 않다.

CoreDNS를 통해 서비스를 찾아내고 쿠브 프록시를 통해서 특정 파드로 로드 밸런싱을 한다.

### 2.1.3 복원성 패턴

마이크로 서비스는 일반적으로 분산 시스템 복원력을 높이기 위해 여러 가용 영역에 수평 확장이 가능하도록 배포한다.

서비스 메시를 사용하면 네트워크 구간의 모니터링이 가능하고 복원성 패턴을 구현할 수 있다.

관측 가능성 시스템은 서비스 메시를 필요로 하지 않는다.

백엔드 프런트엔드에서 서비스 메시를 구현한다.

### 2.1.4 가시성

관측 가능성의 한계를 보완하고, 다양한 장애를 극복할 수 있는 복원력을 제공한다.

가시성은 네트워크 분야에서 사용되는 용어다.

가시성은 관측 가능성의 강점은 예측 가능과 결합해서 장애 빈도를 줄이고, 장애 원인에 대한 신속한 분석이 가능하다.

- 운영의 베스트 프랙티스는 장애를 최소화할 수 있도록 충분한 테스트를 통해서 버그와 오류를 조기에 발견하고 프로세스를 자동화하는 것이다. 장애에 내성을 가지고 견고한 인프라를 구성하고 유저 트래픽을 가능한 근사치로 예상해서 그에 준하는 시스템의 성능과 용량을 확보하는 것을 권장한다.
- 클라우드에서 장애를 정의하고 대응하는 방법은 예전과 다르다. 선제적인 조치보다는 장애 이후에 초점을 맞추는 경향이 있는데, 올바른 대응 방안이라 할 수 없다. 장애가 될 만한 위험 요인을 미리 발견해서 최소화하고, 트래픽을 관리하고 복원력을 향상시켜야 않다.

가시성의 문맥적인 의미는 배경에서 분라된 가시 대상의 존재나 색의 차이를 잘 볼 수 있는 정도 또는 상태이며, 이는 시스템에 대한 자세한 이해보다는 대략적인 이해 수준에 머무르는 것이다.

즉 시스템을 이해하는 수준의 정도에 차이가 있고, 이로 인해 원인을 이해하고 분석하는 부분에서 한계를 드러낸다.

이러한 한계의 이유는 가시성의 대상이 주로 하드웨어, 인프라이기 때문이다.

이로 인해 가시성은 로그를 수집하고 분석하는 일에 집중하는 경향이 있다.

네트워크 프로토콜은 HTTP, DNS 등이 있으며 관련 서버에서 로그를 수집한다.

엔드포인트는 개인 PC 등이 대상이며 필요 시에는 이벤트 로그를 수집한다.

메트릭은 벤더에서 제공하는 메트릭을 사용하거나 솔루션에서 기본적으로 제공하는 관리 화면을 통해 메트릭을 제공하는 경우가 대부분이다.

### 2.1.5 서비스 메시

넷플릭스 오픈소스 소프트웨어도 우수한 서비스 메시 솔루션이고, 이스티오가 제공하지 않는 세밀한 조정이 가능하다.

- 클라이언트 측 부하 분산을 사용해서 오토스케일링을 구현하였다.
- 다양한 플랫폼과 개발 언어를 지원한다. Go 파이썬을 사용하여 애플리케이션을 개발하였으므로 넷플릯스 OSS를 적용할 수 없다. 다양한 언어를 지원하는 서비스 메시 플랫폼이 필요하다.
- 견고한 내부 아키텍처 외에 사용자 화면이 필요하다. 카일리는 동적인 네트워크 모니터링을 위한 풍부한 기능을 제공해주며, 그라파나 가능성과 쉽게 통합할 수 있다.
- 데이터 관점에서 이스티오와 앤보이 프록시는 높은 품질의 액세스 로그를 제공한다. 액세스 로그를 사용해서 다양한 데이터 분석이 가능하다.

## 2.2 쿠버네티스 오토스케일링

쿠머네티스는 CPU 사용률이나 기타 메트릭을 체크하여 파드의 개수를 스케일하는 기능을 갖고 있다.
이것은 HPA로 지정한 메트릭을 컨트롤러가 체크하여 부하에 따라 필요한 레플리카 수가 되도록 자동으로 파드를 늘리거나 줄이는 것이다.
HPA는 파드를 오토스케일링하며, 레플리카셋을 포함한 다음 리소스의 파드 스케일링에 사용할 수 있다.

- 디플로이먼트
- 레플리카셋
- 레플리케이션 컨트롤러
- 스테이트풀셋

관측 가능성은 대용량 트래픽을 안정적으로 처리하고 비용을 절감해야 한다.
그러므로 관측 가능성 시스템에도 쿠버네티스 오토스케일링을 적용해야 한다.

그라파나 관측 가능성 도구 내 다양한 컴포넌트에 오토스케일링을 적용할 수 있다.

예를 들어 인제스터, 디스트리뷰터, 쿼리어, 쿼리-프런트엔드 게이트웨이에 오토스케일링을 적용하고, 각 구성 요소에는 별도의 해시 링을 구성한다.

### 2.2.1 오토스케일링 오픈소스

### 2.2.2 메트릭 측정

### 2.2.3 메트릭 선정

## 2.3 관측 가능성 프로세스

### 2.3.1 관측 가능성 운영 프로세스

### 2.3.2 관측 가능성 장애 프로세스

## 2.4 수평 샤딩

## 2.5 마이크로서비스

### 2.5.1 마이크로서비스 개발 흐름

### 2.5.2 관측 가능성의 마이크로서비스

### 2.5.3 읽기와 쓰기를 분리하기

## 2.6 일관된 해시

## 2.7 관측 가능성 시각화

## 2.8 키-값 저장소

## 2.9 객체 스토리지

## 2.10 안정적 데이터 관리

## 2.11 시계열 데이터 집계
