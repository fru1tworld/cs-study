# 2. 클러스터

## 2.2 멀티테넌시

### 2.2.1 멀티테넌시 적용을 위한 요구사항

멀티테넌시는 클러스터를 여러 그룹이나 워크로드 사이에 공유하는 방식이나, 단순히 물리적 스토리지나 처리 능력을 공유하는 것처럼 보이기도 하지만, 저장된 데이터의 공유가 가능해진다는 것이 멀티테넌시의 진정한 장점이다.

멀티테넌시는 클러스터 관점에서 다음과 같은 의미로 사용된다.

- 엔터프라이즈 환경 안의 여러 구성요소 사이에 공유되는 클러스터
- 구현 사용자 인수 테스트 등 여러 개발 단계에 사용되는 클러스터
- 운영 중인 여러 원격 클러스터에서 생산되는 데이터의 백업 보관소로 사용되는 클러스터

3가지 모두 다른 의미지만 멀티테넌시라는 하나의 용어로 표현될 수 있다.

엔터프라이즈 환경에 멀팉테넌시를 적용하면 클러스터 관리를 하나의 전담 팀에 맡겨서 중앙 관리할 수 있으므로, 엔터프라이즈 구성요소를 담당하는 부서마다 이질적인 플랫폼 관리 역할을 두는 것보다 유리하다.

## 2.3 클러스터 용량 산정

클러스터의 개수와 용도가 결정되면 클러스터의 용량을 산정해야 한다.

이번 절에서는 데이터 스토리지, 데이터 입수 및 처리 능력을 고려해서 여러 가지 용량 산정 방법을 알아본다.

### 2.3.1 스토리지 용량 산정

일반적으로 다음과 같은 알고리즘을 따른다.

1. 저장할 데이터의 크기 결정
2. 전체 스토리지 공간의 크기 결정
3. 서버당 스토리지 공간 크기 결정
4. 전체 스토리지 공간 크기를 서버당 스토리지 공간 크리고 나눈다. (2/3)

HDFS에 저장한다면 클러스터의 크기는 데이터 저장 방식에 따라 달라진다. 기본 복제 전략을 따른다면 3군데에 데이터를 복제하게 된다.

따라서 3배의 공간이 필요하고, 원본 데이터셋 크기만큼의 임시 데이터 저장 공간도 필요하므로 결국 원래 데이터셋의 크기에 4를 곱하면 된다.

이레이저 코딩 전략을 사용하면 이레이저 코딩에 50% 추가 공간이 필요하고, 원본 데이터셋 크기 만큼의 임시 데이터 저장 공간도 필요하므로, 원래 데이터셋 크기에 2.5를 곱하면 된다.

이런 계산 방식은 지나칠 정도로 간단해보이는데 몇가지 더 고려사항이 존재한다.

##### 데이터 표현 방식

데이터가 원본 포맷 그대로 저장될까, 아니면 아파치 파케이처럼 더 효율적인 컬럼 방식으로 변환되어 저장되나? 변환된다면 압축도 필요한가? 어떤 압축 코덱을 쓸 것이며, 압축률은 어느 정도인가? 파일 개수를 관리하기 위한 압축이 필요한가 ?

##### 데이터 증가

데이터셋의 크기가 시간에 따라 증가하나? 그렇다면 단기간의 수요를 충족하면 되나, 아니면 장기간의 수요를 충족해야 하나? 증가 속도를 보수적으로 잡아도되나, 아니면 비상시를 대비해 더 많은 여유를 둬야 할까 ?

##### 데이터 보유

제도적 목적으로 데이터를 장기간 보관할 필요가 있나 ? 변환/필터/정제된 데이터와 원본 데이터를 모두 보관해야 하나? 전체 기간 동안의 모든 개별 트랜잭션 보관이 필요한가 ? 아니면 과거 데이터에 대해서는 집계뙨 데이터만으로 충분한가 ?

##### 데이터셋 크기 정확성

클러스터 용량 산정에 사용될 데이터셋이 파일 기반 스토리지 포맷으로 이미 저장돼 있는가 ? 아니면 데이터셋이 저장될 다른 IT 시스템 기준으로 용량을 재산정해야 하나 ? 소스 시스템이 관계형 데이터베이스라면 데이터셋의 크기는 해당 RDBMS에서 표현하는 방식에 따라 달라진다.

#### 스토리지 기준 카프카 규모 산정

카프카가 사용할 수 있는 스토리지의 크기는 카프카가 설치된 서버의 스토리지 용량을 넘을 수 없다.

일반적으로 메시지 보관 정책은 7일이며, 특정 토픽에 대해 제한을 걸 수도 있다.

카프카가 사용할 수 있는 스토리지 공간 한계가 있으므로 프로듀서가 평소와 다르게 대용량 메시지를 보낸다면 보관기간은 줄어들 수 있다.

비즈니스상 이유로 보관 기간이 반드시 7일 이어야 한다면 최고점 기준으로 7일치의 메시지를 저장할 수 있도록 클러스터 크기를 늘려야 한다.
