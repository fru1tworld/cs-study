# 01 쿠버네티스 시작하기

## 쿠버네티스란?

### 정의

컨테이너화된 애플리케이션의 배포, 확장, 관리를 자동화하기 위한 오픈소스 플랫폼

### 주요 특징

- **자동화된 배포와 롤백**: 애플리케이션의 원하는 상태 선언
- **서비스 디스커버리와 로드 밸런싱**: DNS 이름이나 IP 주소로 컨테이너 노출
- **스토리지 오케스트레이션**: 로컬 스토리지, 퍼블릭 클라우드 등 자동 마운트
- **자동화된 빈 패킹**: 컨테이너 실행에 필요한 CPU와 메모리 자동 할당
- **자가 치유**: 실패한 컨테이너 재시작, 교체
- **시크릿과 구성 관리**: 민감한 정보 안전하게 저장 및 관리

## 쿠버네티스가 필요한 이유

### 컨테이너의 한계

- 수동 관리의 복잡성
- 스케일링의 어려움
- 고가용성 확보의 어려움

### 쿠버네티스의 해결책

- 선언적 구성 (Declarative Configuration)
- 자동 복구 (Self-healing)
- 수평 확장 (Horizontal Scaling)

## 쿠버네티스 아키텍처

### 클러스터 구조

```
                 ┌─────────────────┐
                 │  Control Plane  │
                 │                 │
                 │  - API Server   │
                 │  - Scheduler    │
                 │  - Controller   │
                 │  - etcd         │
                 └─────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
   ┌────▼────┐       ┌────▼────┐       ┌────▼────┐
   │  Node 1 │       │  Node 2 │       │  Node 3 │
   │         │       │         │       │         │
   │  Pods   │       │  Pods   │       │  Pods   │
   └─────────┘       └─────────┘       └─────────┘
```

### Control Plane 구성 요소

- **API Server**: 쿠버네티스 API 제공, 클러스터의 프론트엔드
- **etcd**: 모든 클러스터 데이터를 저장하는 고가용성 키-값 저장소
- **Scheduler**: 새로운 파드를 실행할 노드 선택
- **Controller Manager**: 컨트롤러 프로세스 실행

### Node 구성 요소

- **kubelet**: 각 노드에서 실행되는 에이전트
- **kube-proxy**: 네트워크 프록시
- **Container Runtime**: 컨테이너 실행 (Docker, containerd 등)

## 핵심 개념

### Pod

- 쿠버네티스에서 생성하고 관리할 수 있는 가장 작은 배포 단위
- 하나 이상의 컨테이너 그룹

### Deployment

- 파드와 레플리카셋에 대한 선언적 업데이트 제공
- 원하는 상태를 정의하면 컨트롤러가 실제 상태를 변경

### Service

- 파드의 논리적 집합과 접근 정책 정의
- 로드 밸런싱과 서비스 디스커버리 제공

## 쿠버네티스 설치

### Minikube

로컬 쿠버네티스 클러스터 실행 도구

```bash
# Minikube 설치
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64
sudo install minikube-darwin-amd64 /usr/local/bin/minikube

# 클러스터 시작
minikube start

# 상태 확인
minikube status
```

### kubectl 설치

쿠버네티스 CLI 도구

```bash
# kubectl 설치 (macOS)
brew install kubectl

# 버전 확인
kubectl version --client
```

## 첫 번째 애플리케이션 배포

### 간단한 웹 애플리케이션 배포

```bash
# Deployment 생성
kubectl create deployment hello-k8s --image=nginx

# 확인
kubectl get deployments
kubectl get pods

# 외부 노출
kubectl expose deployment hello-k8s --type=NodePort --port=80

# 서비스 확인
kubectl get services

# 접속
minikube service hello-k8s
```

### YAML로 리소스 정의

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: hello-k8s
spec:
  replicas: 3
  selector:
    matchLabels:
      app: hello-k8s
  template:
    metadata:
      labels:
        app: hello-k8s
    spec:
      containers:
        - name: nginx
          image: nginx:1.21
          ports:
            - containerPort: 80
```

```bash
# 적용
kubectl apply -f deployment.yaml

# 삭제
kubectl delete -f deployment.yaml
```

## 기본 kubectl 명령어

### 리소스 조회

```bash
kubectl get pods
kubectl get deployments
kubectl get services
kubectl get all
```

### 상세 정보 확인

```bash
kubectl describe pod <pod-name>
kubectl logs <pod-name>
kubectl exec -it <pod-name> -- /bin/bash
```

### 리소스 관리

```bash
kubectl apply -f <file.yaml>
kubectl delete pod <pod-name>
kubectl scale deployment <name> --replicas=5
```

## 쿠버네티스 오브젝트 모델

### 메타데이터

- **Name**: 오브젝트의 고유 이름
- **Namespace**: 가상 클러스터
- **Labels**: 키-값 쌍의 메타데이터
- **Annotations**: 추가 정보

### Spec과 Status

- **Spec**: 원하는 상태 정의
- **Status**: 현재 상태 (쿠버네티스가 관리)

## 교훈

1. **쿠버네티스는 컨테이너 오케스트레이션 플랫폼이다**
2. **선언적 구성으로 인프라를 코드로 관리한다**
3. **파드가 가장 작은 배포 단위다**
4. **kubectl은 클러스터와 상호작용하는 주요 도구다**
5. **쿠버네티스는 원하는 상태를 유지하려 노력한다**
